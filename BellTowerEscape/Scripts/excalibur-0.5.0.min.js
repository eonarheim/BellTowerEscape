/*! excalibur - v0.5.0 - 2015-06-03
* https://github.com/excaliburjs/Excalibur
* Copyright (c) 2015 ; Licensed BSD*/
"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,n;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),o=s.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(i=e),n=0;o>n;){var r;n in s&&(r=s[n],t.call(i,r,n,s)),n++}}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments.length>=2?arguments[1]:void 0,s=0;i>s;s++)if(s in e&&t.call(n,e[s],s,e))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s});var ex;(function(t){var e;(function(e){var i=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),s=i.data,o=(s[n+0]+s[n+1]+s[n+2])/3;s[n+0]=o,s[n+1]=o,s[n+2]=o},t}();e.Grayscale=i;var n=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),s=i.data;s[n+0]=255-s[n+0],s[n+1]=255-s[n+1],s[n+2]=255-s[n+2]},t}();e.Invert=n;var s=function(){function t(t){this.opacity=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),s=i.data;0!==s[n+3]&&(s[n+3]=Math.round(255*this.opacity))},t}();e.Opacity=s;var o=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),s=i.data;0!==s[n+3]&&(s[n+0]=(s[n+0]+this.color.r)/2,s[n+1]=(s[n+1]+this.color.g)/2,s[n+2]=(s[n+2]+this.color.b)/2)},t}();e.Colorize=o;var r=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,n){var s=4*(e+i*n.width),o=n.data,r=t.Color.fromRGB(o[s+0],o[s+1],o[s+2],o[s+3]).lighten(this.factor);o[s+0]=r.r,o[s+1]=r.g,o[s+2]=r.b,o[s+3]=r.a},e}();e.Lighten=r;var h=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,n){var s=4*(e+i*n.width),o=n.data,r=t.Color.fromRGB(o[s+0],o[s+1],o[s+2],o[s+3]).darken(this.factor);o[s+0]=r.r,o[s+1]=r.g,o[s+2]=r.b,o[s+3]=r.a},e}();e.Darken=h;var a=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,n){var s=4*(e+i*n.width),o=n.data,r=t.Color.fromRGB(o[s+0],o[s+1],o[s+2],o[s+3]).saturate(this.factor);o[s+0]=r.r,o[s+1]=r.g,o[s+2]=r.b,o[s+3]=r.a},e}();e.Saturate=a;var c=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,n){var s=4*(e+i*n.width),o=n.data,r=t.Color.fromRGB(o[s+0],o[s+1],o[s+2],o[s+3]).desaturate(this.factor);o[s+0]=r.r,o[s+1]=r.g,o[s+2]=r.b,o[s+3]=r.a},e}();e.Desaturate=c;var u=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var n=4*(t+e*i.width),s=i.data;0!==s[n+3]&&(s[n+0]=this.color.r,s[n+1]=this.color.g,s[n+2]=this.color.b)},t}();e.Fill=u})(e=t.Effects||(t.Effects={}))})(ex||(ex={}));var ex;(function(t){var e;(function(t){var e=function(){function t(){}return t.prototype.update=function(t,e,i){t.x+=t.dx*i/1e3,t.y+=t.dy*i/1e3,t.dx+=t.ax*i/1e3,t.dy+=t.ay*i/1e3,t.rotation+=t.rx*i/1e3,t.scale.x+=t.sx*i/1e3,t.scale.y+=t.sy*i/1e3},t}();t.Movement=e})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._topLeft=new t.Point(0,0),this._topRight=new t.Point(0,0),this._bottomLeft=new t.Point(0,0),this._bottomRight=new t.Point(0,0)}return e.prototype.isSpriteOffScreen=function(e,i){var n=e.currentDrawing.width*e.currentDrawing.scale.x,s=e.currentDrawing.height*e.currentDrawing.scale.y,o=e.rotation,r=e.getCenter().toPoint();this._topLeft.x=e.getWorldX()-n/2,this._topLeft.y=e.getWorldY()-s/2,this._topLeft=this._topLeft.rotate(o,r),this._topRight.x=e.getWorldX()+n/2,this._topRight.y=e.getWorldY()-s/2,this._topRight=this._topRight.rotate(o,r),this._bottomLeft.x=e.getWorldX()-n/2,this._bottomLeft.y=e.getWorldY()+s/2,this._bottomLeft=this._bottomLeft.rotate(o,r),this._bottomRight.x=e.getWorldX()+n/2,this._bottomRight.y=e.getWorldY()+s/2,this._bottomRight=this._bottomRight.rotate(o,r);var h=i.worldToScreenCoordinates(this._topLeft),a=i.worldToScreenCoordinates(this._topRight),c=i.worldToScreenCoordinates(this._bottomLeft),u=i.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(h.x,a.x,c.x,u.x),this._yCoords.push(h.y,a.y,c.y,u.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var l=[];l.push(new t.Point(this._xMin,this._yMin),new t.Point(this._xMax,this._yMin),new t.Point(this._xMin,this._yMax),new t.Point(this._xMax,this._yMax));for(var p=0;l.length>p;p++)if(l[p].x>0&&l[p].y>0&&l[p].x<i.width&&l[p].y<i.height)return!1;return!0},e.prototype.debugDraw=function(e){e.beginPath(),e.strokeStyle=""+t.Color.White,e.rect(this._xMin,this._yMin,this._xMax-this._xMin,this._yMax-this._yMin),e.stroke(),e.fillStyle=""+t.Color.Red,e.beginPath(),e.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=""+t.Color.Green,e.beginPath(),e.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=""+t.Color.Blue,e.beginPath(),e.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=""+t.Color.Magenta,e.beginPath(),e.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),e.closePath(),e.fill()},e}();t.CullingBox=e})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(){this.cullingBox=new t.CullingBox}return e.prototype.update=function(e,i){var n=e.eventDispatcher,s=e.anchor,o=e.getGlobalScale(),r=o.x*e.getWidth()/e.scale.x,h=o.y*e.getHeight()/e.scale.y,a=i.worldToScreenCoordinates(new t.Point(e.getWorldX()-s.x*r,e.getWorldY()-s.y*h)),c=1;e.scene&&e.scene.camera&&(c=e.scene.camera.getZoom());var u=!0;null!=e.currentDrawing&&(u=this.cullingBox.isSpriteOffScreen(e,i)),e.isOffScreen?(a.x+r*c>0&&a.y+h*c>0&&a.x<i.width&&a.y<i.height||!u)&&(n.publish("enterviewport",new t.EnterViewPortEvent),e.isOffScreen=!1):(0>a.x+r*c||0>a.y+h*c||a.x>i.width||a.y>i.height)&&u&&(n.publish("exitviewport",new t.ExitViewPortEvent),e.isOffScreen=!0)},e}();e.OffscreenCulling=i})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){var e;(function(t){var e=function(){function t(){}return t.prototype.update=function(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.propogate(t))},t}();t.CapturePointer=e})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(){}return e.prototype.update=function(e,i){var n=e.eventDispatcher;if(0!==e.collisionType)for(var s=0;i.currentScene.tileMaps.length>s;s++)for(var o,r=i.currentScene.tileMaps[s],h=0,a=2,c=!1;(o=r.collides(e))&&!(0>a--);)h=e.getSideFromIntersect(o),n.publish("collision",new t.CollisionEvent(e,null,h,o)),(2===e.collisionType||3===e.collisionType)&&(e.y+=o.y,e.x+=o.x,3!==e.collisionType||c||(c=!0,3===h?e.dx=Math.abs(e.dx):4===h?e.dx=-Math.abs(e.dx):1===h?e.dy=Math.abs(e.dy):2===h&&(e.dy=-Math.abs(e.dy))))},e}();e.CollisionDetection=i})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){(function(t){t[t.None=0]="None",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left",t[t.Right=4]="Right"})(t.Side||(t.Side={})),t.Side})(ex||(ex={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},ex;(function(t){var e=function(){function e(t,e){this.x=t,this.y=e}return e.prototype.toVector=function(){return new i(this.x,this.y)},e.prototype.rotate=function(i,n){n||(n=new t.Point(0,0));var s=Math.sin(i),o=Math.cos(i),r=o*(this.x-n.x)-s*(this.y-n.y)+n.x,h=s*(this.x-n.x)+o*(this.y-n.y)+n.y;return new e(r,h)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.setTo=function(t,e){this.x=t,this.y=e},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e}();t.Point=e;var i=function(t){function i(e,i){t.call(this,e,i),this.x=e,this.y=i}return __extends(i,t),i.fromAngle=function(t){return new i(Math.cos(t),Math.sin(t))},i.prototype.distance=function(t){return t||(t=new i(0,0)),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},i.prototype.normalize=function(){var t=this.distance();return t>0?new i(this.x/t,this.y/t):new i(0,1)},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.plus=function(t){return this.add(t)},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return this.minus(t)},i.prototype.minus=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.cross=function(t){return this.x*t.y-this.y*t.x},i.prototype.perpendicular=function(){return new i(this.y,-this.x)},i.prototype.normal=function(){return this.perpendicular().normalize()},i.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},i.prototype.toPoint=function(){return new e(this.x,this.y)},i.prototype.rotate=function(e,i){return t.prototype.rotate.call(this,e,i).toVector()},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=new i(0,0),i}(e);t.Vector=i;var n=function(){function t(t,e){this.pos=t,this.dir=e.normalize()}return t.prototype.intersect=function(t){var e=t.begin.toVector().minus(this.pos.toVector());if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;var i=this.dir.cross(t.getSlope());if(0===i)return-1;var n=e.cross(t.getSlope())/i;if(n>=0){var s=e.cross(this.dir)/i/t.getLength();if(s>=0&&1>=s)return n}return-1},t.prototype.getPoint=function(t){return this.pos.toVector().add(this.dir.scale(t)).toPoint()},t}();t.Ray=n;var s=function(){function t(t,e){this.begin=t,this.end=e}return t.prototype.getSlope=function(){var t=this.begin.toVector(),e=this.end.toVector(),i=t.distance(e);return e.minus(t).scale(1/i)},t.prototype.getLength=function(){var t=this.begin.toVector(),e=this.end.toVector(),i=t.distance(e);return i},t}();t.Line=s;var o=function(){function t(t,e){this.min=t,this.max=e}return t.prototype.overlaps=function(t){return this.max>t.min&&t.max>this.min},t.prototype.getOverlap=function(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0},t}();t.Projection=o})(ex||(ex={}));var ex;(function(t){var e;(function(e){function i(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",n=0;t.length>n;){var s,o,r=255&t.charCodeAt(n++),h=255&t.charCodeAt(n++),a=255&t.charCodeAt(n++),c=r>>2,u=(3&r)<<4|h>>4;isNaN(h)?s=o=64:(s=(15&h)<<2|a>>6,o=isNaN(a)?64:63&a),i+=e.charAt(c)+e.charAt(u)+e.charAt(s)+e.charAt(o)}return i}function n(t,e,i){return e>=t?e:t>=i?i:t}function s(t,e,i,n,s,o){t.beginPath(),t.strokeStyle=e,t.moveTo(i,n),t.lineTo(s,o),t.closePath(),t.stroke()}function o(t,e){return t+Math.random()*(e-t)}function r(t,e){return Math.round(o(t,e))}function h(t){var e=t;if(t>this.TwoPI)for(;e>this.TwoPI;)e-=this.TwoPI;if(0>t)for(;0>e;)e+=this.TwoPI;return e}function a(t){return 180/Math.PI*t}function c(t){return t/180*Math.PI}function u(e){var i=0,n=0,s=function(t){i+=t.offsetLeft,t.offsetParent&&s(t.offsetParent)},o=function(t){n+=t.offsetTop,t.offsetParent&&o(t.offsetParent)};return s(e),o(e),new t.Point(i,n)}function l(t,e){return-1===e.indexOf(t)?(e.push(t),!0):!1}function p(t,e){var i=-1;return(i=e.indexOf(t))>-1?(e.splice(i,1),!0):!1}function d(t){return 1===t?2:2===t?1:3===t?4:4===t?3:0}e.TwoPI=2*Math.PI,e.base64Encode=i,e.clamp=n,e.drawLine=s,e.randomInRange=o,e.randomIntInRange=r,e.canonicalizeAngle=h,e.toDegrees=a,e.toRadians=c,e.getPosition=u,e.addItemToArray=l,e.removeItemToArray=p,e.getOppositeSide=d;var f=function(){function t(e){void 0===e&&(e=t.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=Array(e)}return t.prototype._resize=function(){for(var t=2*this._internalArray.length,e=Array(t),i=this.count(),n=0;i>n;n++)e[n]=this._internalArray[n];delete this._internalArray,this._internalArray=e},t.prototype.push=function(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t},t.prototype.pop=function(){return this._endPointer=0>this._endPointer-1?0:this._endPointer-1,this._internalArray[this._endPointer]},t.prototype.count=function(){return this._endPointer},t.prototype.clear=function(){this._endPointer=0},t.prototype.internalSize=function(){return this._internalArray.length},t.prototype.elementAt=function(t){return t>=this.count()?void 0:this._internalArray[t]},t.prototype.insert=function(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e},t.prototype.remove=function(t){var e=this.count();if(0!==e){for(var i=this._internalArray[t],n=t;e>n;n++)this._internalArray[n]=this._internalArray[n+1];return this._endPointer--,i}},t.prototype.removeElement=function(t){var e=this._internalArray.indexOf(t);this.remove(e)},t.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},t.prototype.forEach=function(t){var e=0,i=this.count();for(e;i>e;e++)t.call(this,this._internalArray[e],e)},t.prototype.map=function(t){for(var e=this.count(),i=0;e>i;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)},t.DefaultSize=200,t}();e.Collection=f})(e=t.Util||(t.Util={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,n,s,o){var r=this;this.sx=i,this.sy=n,this.swidth=s,this.sheight=o,this.rotation=0,this.anchor=new t.Point(0,0),this.scale=new t.Point(1,1),this.logger=t.Logger.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.effects=[],this.internalImage=new Image,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1,(0>i||0>n||0>s||0>o)&&this.logger.error("Sprite cannot have any negative dimensions x:",i,"y:",n,"width:",s,"height:",o),this._texture=e,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=s,this._spriteCanvas.height=o,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then(function(){r._spriteCanvas.width=r._spriteCanvas.width||r._texture.image.naturalWidth,r._spriteCanvas.height=r._spriteCanvas.height||r._texture.image.naturalHeight,r._loadPixels(),r._dirtyEffect=!0}).error(function(t){r.logger.error("Error loading texture ",r._texture.path,t)}),this.width=s,this.height=o}return e.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var e=t.Util.clamp,i=this._texture.image.naturalWidth||0,n=this._texture.image.naturalHeight||0;this.swidth>i&&this.logger.warn("The sprite width",this.swidth,"exceeds the width",i,"of the backing texture",this._texture.path),this.sheight>n&&this.logger.warn("The sprite height",this.sheight,"exceeds the height",n,"of the backing texture",this._texture.path),this._spriteCtx.drawImage(this._texture.image,e(this.sx,0,i),e(this.sy,0,n),e(this.swidth,0,i),e(this.sheight,0,n),0,0,this.swidth,this.sheight),this.internalImage.src=this._spriteCanvas.toDataURL("image/png"),this._pixelsLoaded=!0}},e.prototype.opacity=function(e){this.addEffect(new t.Effects.Opacity(e))},e.prototype.grayscale=function(){this.addEffect(new t.Effects.Grayscale)},e.prototype.invert=function(){this.addEffect(new t.Effects.Invert)},e.prototype.fill=function(e){this.addEffect(new t.Effects.Fill(e))},e.prototype.colorize=function(e){this.addEffect(new t.Effects.Colorize(e))},e.prototype.lighten=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Lighten(e))},e.prototype.darken=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Darken(e))},e.prototype.saturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Saturate(e))},e.prototype.desaturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Desaturate(e))},e.prototype.addEffect=function(t){this.effects.push(t),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},e.prototype.removeEffect=function(t){var e=null;e="number"==typeof t?t:this.effects.indexOf(t),this.effects.splice(e,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},e.prototype._applyEffects=function(){var e=t.Util.clamp,i=this._texture.image.naturalWidth||0,n=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.drawImage(this._texture.image,e(this.sx,0,i),e(this.sy,0,n),e(this.swidth,0,i),e(this.sheight,0,n),0,0,this.swidth,this.sheight),this._pixelData=this._spriteCtx.getImageData(0,0,this.swidth,this.sheight);var s=0,o=0,r=0,h=this.effects.length;for(s;h>s;s++)for(r=0;this.sheight>r;r++)for(o=0;this.swidth>o;o++)this.effects[s].updatePixel(o,r,this._pixelData);this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.putImageData(this._pixelData,0,0),this.internalImage.src=this._spriteCanvas.toDataURL("image/png")},e.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},e.prototype.reset=function(){},e.prototype.debugDraw=function(e,i,n){e.save(),e.translate(i,n),e.rotate(this.rotation);var s=this.width*this.scale.x*this.anchor.x,o=this.height*this.scale.y*this.anchor.y;e.strokeStyle=t.Color.Black,e.strokeRect(-s,-o,this.width*this.scale.x,this.height*this.scale.y),e.restore()},e.prototype.draw=function(t,e,i){this._dirtyEffect&&(this._applyEffects(),this._dirtyEffect=!1),t.save();var n=this.width*this.scale.x*this.anchor.x,s=this.height*this.scale.y*this.anchor.y;t.translate(e,i),t.rotate(this.rotation),this.flipHorizontal&&(t.translate(this.swidth*this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.sheight*this.scale.y),t.scale(1,-1)),this.internalImage&&t.drawImage(this.internalImage,0,0,this.swidth,this.sheight,-n,-s,this.swidth*this.scale.x,this.sheight*this.scale.y),t.restore()},e.prototype.clone=function(){var t=new e(this._texture,this.sx,this.sy,this.swidth,this.sheight);t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;var i=0,n=this.effects.length;for(i;n>i;i++)t.addEffect(this.effects[i]);return t},e}();t.Sprite=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,n,s,o){this.image=e,this.columns=i,this.rows=n,this.sprites=[],this._internalImage=e.image,this.sprites=Array(i*n);var r=0,h=0;for(r=0;n>r;r++)for(h=0;i>h;h++)this.sprites[h+r*i]=new t.Sprite(this.image,h*s,r*o,s,o)}return e.prototype.getAnimationByIndices=function(e,i,n){var s=this,o=i.map(function(t){return s.sprites[t]});return o=o.map(function(t){return t.clone()}),new t.Animation(e,o,n)},e.prototype.getAnimationBetween=function(e,i,n,s){var o=this.sprites.slice(i,n);return o=o.map(function(t){return t.clone()}),new t.Animation(e,o,s)},e.prototype.getAnimationForAll=function(e,i){var n=this.sprites.map(function(t){return t.clone()});return new t.Animation(e,n,i)},e.prototype.getSprite=function(t){return t>=0&&this.sprites.length>t?this.sprites[t]:void 0},e}();t.SpriteSheet=e;var i=function(e){function i(i,n,s,o,r,h,a){e.call(this,i,o,r,h,a),this.image=i,this.alphabet=n,this.caseInsensitive=s,this._spriteLookup={},this._colorLookup={},this._currentColor=t.Color.Black}return __extends(i,e),i.prototype.getTextSprites=function(){for(var t={},e=0;this.alphabet.length>e;e++){var i=this.alphabet[e];this.caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t},i}(e);t.SpriteFont=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,s,o,r,h){var a=this;this.x=e,this.y=i,this.cellWidth=s,this.cellHeight=o,this.rows=r,this.cols=h,this._collidingX=-1,this._collidingY=-1,this._onScreenXStart=0,this._onScreenXEnd=9999,this._onScreenYStart=0,this._onScreenYEnd=9999,this._spriteSheets={},this.logger=t.Logger.getInstance(),this.data=[],this.data=Array(r*h);for(var c=0;h>c;c++)for(var u=0;r>u;u++)(function(){var t=new n(c*s+e,u*o+i,s,o,c+u*h);a.data[c+u*h]=t})()}return e.prototype.registerSpriteSheet=function(t,e){this._spriteSheets[t]=e},e.prototype.collides=function(e){for(var i=e.x+e.getWidth(),n=e.y+e.getHeight(),s=e.getBounds(),o=[],r=s.left;i>=r;r+=Math.min(e.getWidth()/2,this.cellWidth/2))for(var h=s.top;n>=h;h+=Math.min(e.getHeight()/2,this.cellHeight/2)){var a=this.getCellByPoint(r,h);if(a&&a.solid){var c=s.collides(a.getBounds()),u=e.getCenter().minus(a.getCenter());c&&c.dot(u)>0&&o.push(c)}}if(0===o.length)return null;var l=o.reduce(function(e,i){var n=e.x,s=e.y;return Math.abs(e.x)<Math.abs(i.x)&&(n=i.x),Math.abs(e.y)<Math.abs(i.y)&&(s=i.y),new t.Vector(n,s)});return l},e.prototype.getCellByIndex=function(t){return this.data[t]},e.prototype.getCell=function(t,e){return 0>t||0>e||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]},e.prototype.getCellByPoint=function(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);var i=this.getCell(t,e);return t>=0&&e>=0&&this.cols>t&&this.rows>e&&i?i:null},e.prototype.update=function(e){var i=e.screenToWorldCoordinates(new t.Point(0,0)),n=e.screenToWorldCoordinates(new t.Point(e.width,e.height));this._onScreenXStart=Math.max(Math.floor(i.x/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((i.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor(n.x/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((n.y-this.y)/this.cellHeight)+2,0)},e.prototype.draw=function(t){t.save(),t.translate(this.x,this.y);var e,i,n,s=this._onScreenXStart,o=Math.min(this._onScreenXEnd,this.cols),r=this._onScreenYStart,h=Math.min(this._onScreenYEnd,this.rows);for(s;o>s;s++){for(r;h>r;r++)for(e=this.getCell(s,r).sprites.filter(function(t){return t.spriteId>-1}),i=0,n=e.length;n>i;i++){var a=this._spriteSheets[e[i].spriteSheetKey];if(a){var c=a.getSprite(e[i].spriteId);c?c.draw(t,s*this.cellWidth,r*this.cellHeight):this.logger.warn("Sprite does not exist for id",e[i].spriteId,"in sprite sheet",e[i].spriteSheetKey,c,a)}else this.logger.warn("Sprite sheet",e[i].spriteSheetKey,"does not exist",a)}r=this._onScreenYStart}t.restore()},e.prototype.debugDraw=function(e){var i=this.cols*this.cellWidth,n=this.rows*this.cellHeight;e.save(),e.strokeStyle=""+t.Color.Red;for(var s=0;this.cols+1>s;s++)e.beginPath(),e.moveTo(this.x+s*this.cellWidth,this.y),e.lineTo(this.x+s*this.cellWidth,this.y+n),e.stroke();for(var o=0;this.rows+1>o;o++)e.beginPath(),e.moveTo(this.x,this.y+o*this.cellHeight),e.lineTo(this.x+i,this.y+o*this.cellHeight),e.stroke();var r=t.Color.Red.clone();r.a=.3,this.data.filter(function(t){return t.solid}).forEach(function(t){e.fillStyle=""+r,e.fillRect(t.x,t.y,t.width,t.height)}),this._collidingY>-1&&this._collidingX>-1&&(e.fillStyle=""+t.Color.Cyan,e.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),e.restore()},e}();t.TileMap=e;var i=function(){function t(t,e){this.spriteSheetKey=t,this.spriteId=e}return t}();t.TileSprite=i;var n=function(){function e(e,i,n,s,o,r,h){void 0===r&&(r=!1),void 0===h&&(h=[]),this.x=e,this.y=i,this.width=n,this.height=s,this.index=o,this.solid=r,this.sprites=h,this._bounds=new t.BoundingBox(this.x,this.y,this.x+this.width,this.y+this.height)}return e.prototype.getBounds=function(){return this._bounds},e.prototype.getCenter=function(){return new t.Vector(this.x+this.width/2,this.y+this.height/2)},e.prototype.pushSprite=function(t){this.sprites.push(t)},e.prototype.removeSprite=function(t){var e=-1;(e=this.sprites.indexOf(t))>-1&&this.sprites.splice(e,1)},e.prototype.clearSprites=function(){this.sprites.length=0},e}();t.Cell=n})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree",t[t.SeparatingAxis=2]="SeparatingAxis"})(t.CollisionStrategy||(t.CollisionStrategy={})),t.CollisionStrategy;var e=function(){function e(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.left=t,this.top=e,this.right=i,this.bottom=n}return e.prototype.getWidth=function(){return this.right-this.left},e.prototype.getHeight=function(){return this.bottom-this.top},e.prototype.getPerimeter=function(){var t=this.getWidth(),e=this.getHeight();return 2*(t+e)},e.prototype.contains=function(i){return i instanceof t.Point?this.left<=i.x&&this.top<=i.y&&this.bottom>=i.y&&this.right>=i.x:i instanceof e?this.left<i.left&&this.top<i.top&&i.bottom<this.bottom&&i.right<this.right?!0:!1:!1},e.prototype.combine=function(t){var i=new e(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom));return i},e.prototype.collides=function(i){if(i instanceof e){var n=i,s=this.combine(n);if(s.getWidth()<n.getWidth()+this.getWidth()&&s.getHeight()<n.getHeight()+this.getHeight()){var o=0;o=this.right>=n.left&&this.right<=n.right?n.left-this.right:n.right-this.left;var r=0;return r=this.top<=n.bottom&&this.top>=n.top?n.bottom-this.top:n.top-this.bottom,Math.abs(o)<Math.abs(r)?new t.Vector(o,0):new t.Vector(0,r)}return null}return null},e.prototype.debugDraw=function(t){t.lineWidth=2,t.strokeRect(this.left,this.top,this.getWidth(),this.getHeight())},e}();t.BoundingBox=e;var i=function(){function e(t){this._points=t.map(function(t){return t.toVector()})}return e.prototype.getSides=function(){for(var e=[],i=this._points.length,n=0;i>n;n++)e.push(new t.Line(this._points[n],this._points[(n+1)%i]));return e},e.prototype.getAxes=function(){for(var t=[],e=this._points.length,i=0;e>i;i++)t.push(this._points[i].minus(this._points[(i+1)%e]).normal());return t},e.prototype.project=function(e){for(var i=[],n=this._points.length,s=0;n>s;s++)i.push(this._points[s].dot(e));return new t.Projection(Math.min.apply(Math,i),Math.max.apply(Math,i))},e.prototype.getWidth=function(){var t=this._points.reduce(function(t,e){return Math.min(t,e.x)},1/0),e=this._points.reduce(function(t,e){return Math.max(t,e.x)},-1/0);return e-t},e.prototype.getHeight=function(){var t=this._points.reduce(function(t,e){return Math.min(t,e.y)},1/0),e=this._points.reduce(function(t,e){return Math.max(t,e.y)},-1/0);return t-e},e.prototype.contains=function(e){var i=new t.Ray(e,new t.Vector(1,0)),n=this.getSides().reduce(function(t,e){return i.intersect(e)>=0?t+1:t},0);return 0===n%2?!1:!0},e.prototype.collides=function(t){if(t instanceof e){var i=t,n=this.getAxes();n=i.getAxes().concat(n);for(var s=99999,o=null,r=0;n.length>r;r++){var h=this.project(n[r]),a=i.project(n[r]),c=h.getOverlap(a);if(0===c)return null;s>=c&&(s=c,o=n[r])}return o?o.normalize().scale(s):null}return null},e.prototype.debugDraw=function(e){e.beginPath(),e.lineWidth=2;var i=this._points[0];e.moveTo(i.x,i.y);var n=0,s=this._points.length;for(n;s>n;n++)e.lineTo(this._points[n].x,this._points[n].y);e.lineTo(i.x,i.y),e.closePath(),e.strokeStyle=""+t.Color.Blue,e.stroke()},e}();t.SATBoundingBox=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this.eventDispatcher=new t.EventDispatcher(this)}return e.prototype.addEventListener=function(t,e){this.eventDispatcher.subscribe(t,e)},e.prototype.removeEventListener=function(t,e){this.eventDispatcher.unsubscribe(t,e)},e.prototype.on=function(t,e){this.eventDispatcher.subscribe(t,e)},e.prototype.off=function(t,e){this.eventDispatcher.unsubscribe(t,e)},e.extend=function(t){var i,n=this;i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return n.apply(this,arguments)};var s=function(){this.constructor=i};if(s.prototype=n.prototype,i.prototype=new s,t)for(var o in t)t.hasOwnProperty(o)&&(i.prototype[o]=t[o]);return i.extend=e.extend,i},e}();t.Class=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(e,i,n){this.id=0,this.interval=10,this.fcn=function(){},this.repeats=!1,this._elapsedTime=0,this._totalTimeAlive=0,this.complete=!1,this.scene=null,this.id=t.id++,this.interval=i||this.interval,this.fcn=e||this.fcn,this.repeats=n||this.repeats}return t.prototype.update=function(t){this._totalTimeAlive+=t,this._elapsedTime+=t,this._elapsedTime>this.interval&&(this.fcn.call(this),this.repeats?this._elapsedTime=0:this.complete=!0)},t.prototype.getTimeRunning=function(){return this._totalTimeAlive},t.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},t.id=0,t}();t.Timer=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){}return e.prototype.register=function(){},e.prototype.remove=function(){},e.prototype.evaluate=function(e){for(var i,n,s=e.filter(function(t){return!t.isKilled()&&0!==t.collisionType}),o=[],r=0,h=s.length;h>r;r++){i=s[r];for(var a=r+1;h>a;a++){n=s[a];var c;if(c=i.collides(n)){var u=i.getSideFromIntersect(c),l=new t.CollisionPair(i,n,c,u);o.some(function(t){return t.equals(l)})||o.push(l)}}}var p=0,d=o.length;for(p;d>p;p++)o[p].evaluate();return o},e.prototype.update=function(){return 0},e.prototype.debugDraw=function(){},e}();t.NaiveCollisionResolver=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.parent=e,this.parent=e||null,this.actor=null,this.bounds=new t.BoundingBox,this.left=null,this.right=null,this.height=0}return e.prototype.isLeaf=function(){return!this.left&&!this.right},e}();t.TreeNode=e;var i=function(){function t(){this.root=null,this.nodes={}}return t.prototype.insert=function(t){if(null===this.root)return this.root=t,this.root.parent=null,void 0;for(var i=t.bounds,n=this.root;!n.isLeaf();){var s,o,r=n.left,h=n.right,a=n.bounds.getPerimeter(),c=n.bounds.combine(i),u=c.getPerimeter(),l=2*u,p=2*(u-a),d=0,f=i.combine(r.bounds);r.isLeaf()?d=f.getPerimeter()+p:(o=r.bounds.getPerimeter(),s=f.getPerimeter(),d=s-o+p);var g=0,_=i.combine(h.bounds);if(h.isLeaf()?g=_.getPerimeter()+p:(o=h.bounds.getPerimeter(),s=_.getPerimeter(),g=s-o+p),d>l&&g>l)break;n=g>d?r:h}var y=n.parent,A=new e(y);A.bounds=i.combine(n.bounds),A.height=n.height+1,null!==y?(y.left===n?y.left=A:y.right=A,A.left=n,A.right=t,n.parent=A,t.parent=A):(A.left=n,A.right=t,n.parent=A,t.parent=A,this.root=A);for(var v=t.parent;v;){if(v=this.balance(v),!v.left)throw Error("Parent of current leaf cannot have a null left child"+v);if(!v.right)throw Error("Parent of current leaf cannot have a null right child"+v);v.height=1+Math.max(v.left.height,v.right.height),v.bounds=v.left.bounds.combine(v.right.bounds),v=v.parent}},t.prototype.remove=function(t){if(t===this.root)return this.root=null,void 0;var e,i=t.parent,n=i.parent;if(e=i.left===t?i.right:i.left,n){n.left===i?n.left=e:n.right=e,e.parent=n;for(var s=n;s;)s=this.balance(s),s.bounds=s.left.bounds.combine(s.right.bounds),s.height=1+Math.max(s.left.height,s.right.height),s=s.parent}else this.root=e,e.parent=null},t.prototype.registerActor=function(t){var i=new e;i.actor=t,i.bounds=t.getBounds(),i.bounds.left-=2,i.bounds.top-=2,i.bounds.right+=2,i.bounds.bottom+=2,this.nodes[t.id]=i,this.insert(i)},t.prototype.updateActor=function(t){var e=this.nodes[t.id];if(e){var i=t.getBounds();if(e.bounds.contains(i))return!1;this.remove(e),i.left-=5,i.top-=5,i.right+=5,i.bottom+=5;var n=2*t.dx,s=2*t.dy;return 0>n?i.left+=n:i.right+=n,0>s?i.top+=s:i.bottom+=s,e.bounds=i,this.insert(e),!0}},t.prototype.removeActor=function(t){var e=this.nodes[t.id];e&&(this.remove(e),this.nodes[t.id]=null,delete this.nodes[t.id])
},t.prototype.balance=function(t){if(null===t)throw Error("Cannot balance at null node");if(t.isLeaf()||2>t.height)return t;var e=t.left,i=t.right,n=t,s=e,o=i,r=e.left,h=e.right,a=i.left,c=i.right,u=o.height-s.height;if(u>1)return o.left=n,o.parent=n.parent,n.parent=o,o.parent?o.parent.left===n?o.parent.left=o:o.parent.right=o:this.root=o,a.height>c.height?(o.right=a,n.right=c,c.parent=n,n.bounds=s.bounds.combine(c.bounds),o.bounds=n.bounds.combine(a.bounds),n.height=1+Math.max(s.height,c.height),o.height=1+Math.max(n.height,a.height)):(o.right=c,n.right=a,a.parent=n,n.bounds=s.bounds.combine(a.bounds),o.bounds=n.bounds.combine(c.bounds),n.height=1+Math.max(s.height,a.height),o.height=1+Math.max(n.height,c.height)),o;if(-1>u){if(s.left=n,s.parent=n.parent,n.parent=s,s.parent)if(s.parent.left===n)s.parent.left=s;else{if(s.parent.right!==n)throw"Error rotating Dynamic Tree";s.parent.right=s}else this.root=s;return r.height>h.height?(s.right=r,n.left=h,h.parent=n,n.bounds=o.bounds.combine(h.bounds),s.bounds=n.bounds.combine(r.bounds),n.height=1+Math.max(o.height,h.height),s.height=1+Math.max(n.height,r.height)):(s.right=h,n.left=r,r.parent=n,n.bounds=o.bounds.combine(r.bounds),s.bounds=n.bounds.combine(h.bounds),n.height=1+Math.max(o.height,r.height),s.height=1+Math.max(n.height,h.height)),s}return t},t.prototype.getHeight=function(){return null===this.root?0:this.root.height},t.prototype.query=function(t,e){var i=t.getBounds(),n=function(s){return s&&s.bounds.collides(i)?s.isLeaf()&&s.actor!==t?e.call(t,s.actor)?!0:void 0:n(s.left)||n(s.right):null};return n(this.root)},t.prototype.rayCast=function(){return null},t.prototype.getNodes=function(){var t=function(e){return e?[e].concat(t(e.left),t(e.right)):[]};return t(this.root)},t.prototype.debugDraw=function(t){var e=function(i){i&&(t.strokeStyle=i.isLeaf()?"green":"white",i.bounds.debugDraw(t),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)},t}();t.DynamicTree=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._dynamicCollisionTree=new t.DynamicTree}return e.prototype.register=function(t){this._dynamicCollisionTree.registerActor(t)},e.prototype.remove=function(t){this._dynamicCollisionTree.removeActor(t)},e.prototype.evaluate=function(e){for(var i,n=e.filter(function(t){return!t.isKilled()&&0!==t.collisionType}),s=[],o=0,r=n.length;r>o;o++)i=n[o],this._dynamicCollisionTree.query(i,function(e){if(0===e.collisionType||e.isKilled())return!1;var n;if(n=i.collides(e)){var o=i.getSideFromIntersect(n),r=new t.CollisionPair(i,e,n,o);return s.some(function(t){return t.equals(r)})||s.push(r),!0}return!1});var h=0,a=s.length;for(h;a>h;h++)s[h].evaluate();return s},e.prototype.update=function(t){var e=0,i=0,n=t.length;for(i;n>i;i++)this._dynamicCollisionTree.updateActor(t[i])&&e++;return e},e.prototype.debugDraw=function(t,e){this._dynamicCollisionTree.debugDraw(t,e)},e}();t.DynamicTreeCollisionResolver=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(t,e,i,n){this.left=t,this.right=e,this.intersect=i,this.side=n}return e.prototype.equals=function(t){return t.left===this.left&&t.right===this.right||t.right===this.left&&t.left===this.right},e.prototype.evaluate=function(){this.left.eventDispatcher.publish("collision",new t.CollisionEvent(this.left,this.right,this.side,this.intersect)),this.right.eventDispatcher.publish("collision",new t.CollisionEvent(this.right,this.left,t.Util.getOppositeSide(this.side),this.intersect.scale(-1)));var e=this.side;2!==this.left.collisionType&&3!==this.left.collisionType||1===this.right.collisionType||(this.left.y+=this.intersect.y,this.left.x+=this.intersect.x,3===this.left.collisionType&&(3===e?this.left.dx=Math.abs(this.left.dx):4===e?this.left.dx=-Math.abs(this.left.dx):1===e?this.left.dy=Math.abs(this.left.dy):2===e&&(this.left.dy=-Math.abs(this.left.dy))));var i=t.Util.getOppositeSide(this.side),n=this.intersect.scale(-1);2!==this.right.collisionType&&3!==this.right.collisionType||1===this.left.collisionType||(this.right.y+=n.y,this.right.x+=n.x,3===this.right.collisionType&&(3===i?this.right.dx=Math.abs(this.right.dx):4===i?this.right.dx=-Math.abs(this.right.dx):1===i?this.right.dy=Math.abs(this.right.dy):2===i&&(this.right.dy=-Math.abs(this.right.dy))))},e}();t.CollisionPair=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._focus=new t.Point(0,0),this._lerp=!1,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._totalLerpTime=0,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._isZooming=!1,this._currentZoomScale=1,this._maxZoomScale=1,this._zoomDuration=0,this._elapsedZoomTime=0,this._zoomIncrement=.01}return e.prototype._easeInOutCubic=function(t,e,i,n){return i-=e,t/=n/2,1>t?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},e.prototype.setActorToFollow=function(t){this._follow=t},e.prototype.getFocus=function(){return this._focus},e.prototype.setFocus=function(e,i){this._follow||this._lerp||(this._focus.x=e,this._focus.y=i),this._lerp&&(this._lerpStart=this._focus.clone(),this._lerpEnd=new t.Point(e,i),this._currentLerpTime=0,this._cameraMoving=!0)},e.prototype.shake=function(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i},e.prototype.zoom=function(t,e){void 0===e&&(e=0),this._isZooming=!0,this._maxZoomScale=t,this._zoomDuration=e,e&&(this._zoomIncrement=1e3*(Math.abs(this._maxZoomScale-this._currentZoomScale)/e)),1>this._maxZoomScale?e?this._zoomIncrement=-1*this._zoomIncrement:(this._isZooming=!1,this._setCurrentZoomScale(this._maxZoomScale)):e||(this._isZooming=!1,this._setCurrentZoomScale(this._maxZoomScale))},e.prototype.getZoom=function(){return this._currentZoomScale},e.prototype._setCurrentZoomScale=function(t){this._currentZoomScale=t},e.prototype.update=function(t,e){var i=this.getFocus(),n=0,s=0,o=t.canvas.width,r=t.canvas.height,h=o*this.getZoom(),a=r*this.getZoom();this._lerp&&(this._currentLerpTime<this._lerpDuration&&this._cameraMoving?(this._focus.x=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this._easeInOutCubic(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this._easeInOutCubic(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._focus.y=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this._easeInOutCubic(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this._easeInOutCubic(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._currentLerpTime+=e):(this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1)),this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0):(this._elapsedShakeTime+=e,n=(0|Math.random()*this._shakeMagnitudeX)+1,s=(0|Math.random()*this._shakeMagnitudeY)+1),t.translate(-i.x+n+h/2,-i.y+s+a/2),this._isDoneZooming()?(this._isZooming=!1,this._elapsedZoomTime=0,this._zoomDuration=0,this._setCurrentZoomScale(this._maxZoomScale)):(this._elapsedZoomTime+=e,this._setCurrentZoomScale(this.getZoom()+this._zoomIncrement*e/1e3)),t.scale(this.getZoom(),this.getZoom())},e.prototype.debugDraw=function(t){var e=this.getFocus();t.fillStyle="red",t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.fill()},e.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},e.prototype._isDoneZooming=function(){return 0!==this._zoomDuration?this._elapsedZoomTime>=this._zoomDuration:1>this._maxZoomScale?this._currentZoomScale<=this._maxZoomScale:this._currentZoomScale>=this._maxZoomScale},e}();t.BaseCamera=e;var i=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.getFocus=function(){return this._follow?new t.Point(this._follow.x+this._follow.getWidth()/2,this._focus.y):this._focus},i}(e);t.SideCamera=i;var n=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.getFocus=function(){return this._follow?new t.Point(this._follow.x+this._follow.getWidth()/2,this._follow.y+this._follow.getHeight()/2):this._focus},i}(e);t.LockedCamera=n})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i;(function(e){var i=function(){function e(e,i,n,s,o){this.actor=e,this.easingFcn=o,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new t.Point(0,0),this._lerpEnd=new t.Point(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=s,this._lerpEnd=new t.Point(i,n)}return e.prototype._initialize=function(){this._lerpStart=new t.Point(this.actor.x,this.actor.y),this._currentLerpTime=0,this._distance=this._lerpStart.toVector().distance(this._lerpEnd.toVector())},e.prototype.update=function(t){this._initialized||(this._initialize(),this._initialized=!0);var e=this.actor.x,i=this.actor.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.x=e,this.actor.y=i,this._currentLerpTime+=t):(this.actor.x=this._lerpEnd.x,this.actor.y=this._lerpEnd.y)},e.prototype.isComplete=function(e){return this._stopped||new t.Vector(e.x,e.y).distance(this._lerpStart.toVector())>=this._distance},e.prototype.reset=function(){this._initialized=!1},e.prototype.stop=function(){this._stopped=!0},e}();e.EaseTo=i;var n=function(){function e(e,i,n,s){this._started=!1,this._stopped=!1,this._actor=e,this._end=new t.Vector(i,n),this._speed=s}return e.prototype.update=function(){this._started||(this._started=!0,this._start=new t.Vector(this._actor.x,this._actor.y),this._distance=this._start.distance(this._end),this._dir=this._end.minus(this._start).normalize());var e=this._dir.scale(this._speed);this._actor.dx=e.x,this._actor.dy=e.y,this.isComplete(this._actor)&&(this._actor.x=this._end.x,this._actor.y=this._end.y,this._actor.dy=0,this._actor.dx=0)},e.prototype.isComplete=function(e){return this._stopped||new t.Vector(e.x,e.y).distance(this._start)>=this._distance},e.prototype.stop=function(){this._actor.dy=0,this._actor.dx=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.MoveTo=n;var s=function(){function e(e,i,n,s){if(this._started=!1,this._stopped=!1,this._actor=e,this._end=new t.Vector(i,n),0>=s)throw t.Logger.getInstance().error("Attempted to moveBy time less than or equal to zero : "+s),Error("Cannot move in time <= 0");this._time=s}return e.prototype.update=function(){this._started||(this._started=!0,this._start=new t.Vector(this._actor.x,this._actor.y),this._distance=this._start.distance(this._end),this._dir=this._end.minus(this._start).normalize(),this._speed=this._distance/(this._time/1e3));var e=this._dir.scale(this._speed);this._actor.dx=e.x,this._actor.dy=e.y,this.isComplete(this._actor)&&(this._actor.x=this._end.x,this._actor.y=this._end.y,this._actor.dy=0,this._actor.dx=0)},e.prototype.isComplete=function(e){return this._stopped||new t.Vector(e.x,e.y).distance(this._start)>=this._distance},e.prototype.stop=function(){this._actor.dy=0,this._actor.dx=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.MoveBy=s;var o=function(){function e(e,i,n){this._started=!1,this._stopped=!1,this._actor=e,this._actorToFollow=i,this._current=new t.Vector(this._actor.x,this._actor.y),this._end=new t.Vector(i.x,i.y),this._maximumDistance=void 0!==n?n:this._current.distance(this._end),this._speed=0}return e.prototype.update=function(){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.minus(this._current).normalize());var t=Math.sqrt(Math.pow(this._actorToFollow.dx,2)+Math.pow(this._actorToFollow.dy,2));if(0!==t&&(this._speed=t),this._current.x=this._actor.x,this._current.y=this._actor.y,this._end.x=this._actorToFollow.x,this._end.y=this._actorToFollow.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.minus(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var e=this._dir.scale(this._speed);this._actor.dx=e.x,this._actor.dy=e.y}else this._actor.dx=0,this._actor.dy=0;this.isComplete(this._actor)&&(this._actor.x=this._end.x,this._actor.y=this._end.y,this._actor.dy=0,this._actor.dx=0)},e.prototype.stop=function(){this._actor.dy=0,this._actor.dx=0,this._stopped=!0},e.prototype.isComplete=function(){return this._stopped},e.prototype.reset=function(){this._started=!1},e}();e.Follow=o;var r=function(){function e(e,i,n){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=e,this._actorToMeet=i,this._current=new t.Vector(this._actor.x,this._actor.y),this._end=new t.Vector(i.x,i.y),this._speed=n||0,void 0!==n&&(this._speedWasSpecified=!0)}return e.prototype.update=function(){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.minus(this._current).normalize());var t=Math.sqrt(Math.pow(this._actorToMeet.dx,2)+Math.pow(this._actorToMeet.dy,2));0===t||this._speedWasSpecified||(this._speed=t),this._current.x=this._actor.x,this._current.y=this._actor.y,this._end.x=this._actorToMeet.x,this._end.y=this._actorToMeet.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.minus(this._current).normalize();var e=this._dir.scale(this._speed);this._actor.dx=e.x,this._actor.dy=e.y,this.isComplete(this._actor)&&(this._actor.x=this._end.x,this._actor.y=this._end.y,this._actor.dy=0,this._actor.dx=0)},e.prototype.isComplete=function(){return this._stopped||1>=this._distanceBetween},e.prototype.stop=function(){this._actor.dy=0,this._actor.dx=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.Meet=r;var h=function(){function t(t,e,i){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._speed=i}return t.prototype.update=function(){this._started||(this._started=!0,this._start=this._actor.rotation,this._distance=Math.abs(this._end-this._start)),this._actor.rx=this._speed,this.isComplete(this._actor)&&(this._actor.rotation=this._end,this._actor.rx=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.rotation-this._start)>=this._distance},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.RotateTo=h;var a=function(){function t(t,e,i){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._time=i,this._speed=1e3*((this._end-this._actor.rotation)/i)}return t.prototype.update=function(){this._started||(this._started=!0,this._start=this._actor.rotation,this._distance=Math.abs(this._end-this._start)),this._actor.rx=this._speed,this.isComplete(this._actor)&&(this._actor.rotation=this._end,this._actor.rx=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.rotation-this._start)>=this._distance},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.RotateBy=a;var c=function(){function t(t,e,i,n,s){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=n,this._speedY=s}return t.prototype.update=function(){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var t=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*t}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var e=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*e}this.isComplete(this._actor)&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.ScaleTo=c;var u=function(){function t(t,e,i,n){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._time=n,this._speedX=1e3*((this._endX-this._actor.scale.x)/n),this._speedY=1e3*((this._endY-this._actor.scale.y)/n)}return t.prototype.update=function(){this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY));var t=this._endX<this._startX?-1:1,e=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*t,this._actor.sy=this._speedY*e,this.isComplete(this._actor)&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.ScaleBy=u;var l=function(){function t(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}return t.prototype.update=function(t){this._started||(this._started=!0),this.x=this._actor.x,this.y=this._actor.y,this._elapsedTime+=t},t.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._elapsedTime=0,this._started=!1},t}();e.Delay=l;var p=function(){function t(t,e,i,n){void 0===n&&(n=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*n}return t.prototype.update=function(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete(this._actor)&&(this._actor.visible=!0)},t.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},t.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},t.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},t}();e.Blink=p;var d=function(){function e(t,e,i){this._multiplyer=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=i,t.opacity>e&&(this._multiplyer=-1)}return e.prototype.update=function(e){this._started||(this._started=!0),this._speed>0&&(this._actor.opacity+=this._multiplyer*Math.abs(this._actor.opacity-this._endOpacity)*e/this._speed),this._speed-=e,t.Logger.getInstance().debug("actor opacity: "+this._actor.opacity),this.isComplete(this._actor)&&(this._actor.opacity=this._endOpacity)},e.prototype.isComplete=function(){return this._stopped||.05>Math.abs(this._actor.opacity-this._endOpacity)},e.prototype.stop=function(){this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.Fade=d;var f=function(){function t(t){this._started=!1,this._stopped=!1,this._actor=t}return t.prototype.update=function(){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){},t.prototype.reset=function(){},t}();e.Die=f;var g=function(){function t(t,e){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=e}return t.prototype.update=function(){this._method.call(this._actor),this._hasBeenCalled=!0},t.prototype.isComplete=function(){return this._hasBeenCalled},t.prototype.reset=function(){this._hasBeenCalled=!1},t.prototype.stop=function(){this._hasBeenCalled=!0},t}();e.CallMethod=g;var _=function(){function t(t,e,i){this._stopped=!1,this._actor=t,this._actionQueue=new A(t),this._repeat=e,this._originalRepeat=e;var n=0,s=i.length;for(n;s>n;n++)i[n].reset(),this._actionQueue.add(i[n])}return t.prototype.update=function(t){this.x=this._actor.x,this.y=this._actor.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)},t.prototype.isComplete=function(){return this._stopped||0>=this._repeat},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._repeat=this._originalRepeat},t}();e.Repeat=_;var y=function(){function t(t,e){this._stopped=!1,this._actor=t,this._actionQueue=new A(t);var i=0,n=e.length;for(i;n>i;i++)e[i].reset(),this._actionQueue.add(e[i])}return t.prototype.update=function(t){this.x=this._actor.x,this.y=this._actor.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},t.prototype.reset=function(){},t}();e.RepeatForever=y;var A=function(){function t(t){this._actions=[],this._completedActions=[],this._actor=t}return t.prototype.add=function(t){this._actions.push(t)},t.prototype.remove=function(t){var e=this._actions.indexOf(t);this._actions.splice(e,1)},t.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},t.prototype.getActions=function(){return this._actions.concat(this._completedActions)},t.prototype.hasNext=function(){return this._actions.length>0},t.prototype.reset=function(){this._actions=this.getActions();var t=0,e=this._actions.length;for(t;e>t;t++)this._actions[t].reset();this._completedActions=[]},t.prototype.update=function(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},t}();e.ActionQueue=A})(i=e.Actions||(e.Actions={}))})(e=t.Internal||(t.Internal={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(function(t){return t.actionQueue}))}return e.prototype.clearActions=function(){var t=0,e=this._queues.length;for(t;e>t;t++)this._queues[t].clearActions()},e.prototype.addActorToContext=function(t){this._actors.push(t),this._queues.push(t.actionQueue)},e.prototype.removeActorFromContext=function(t){var e=this._actors.indexOf(t);e>-1&&(this._actors.splice(e,1),this._queues.splice(e,1))},e.prototype.moveTo=function(e,i,n){var s=0,o=this._queues.length;for(s;o>s;s++)this._queues[s].add(new t.Internal.Actions.MoveTo(this._actors[s],e,i,n));return this},e.prototype.moveBy=function(e,i,n){var s=0,o=this._queues.length;for(s;o>s;s++)this._queues[s].add(new t.Internal.Actions.MoveBy(this._actors[s],e,i,n));return this},e.prototype.rotateTo=function(e,i){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.RotateTo(this._actors[n],e,i));return this},e.prototype.rotateBy=function(e,i){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.RotateBy(this._actors[n],e,i));return this},e.prototype.scaleTo=function(e,i,n,s){var o=0,r=this._queues.length;for(o;r>o;o++)this._queues[o].add(new t.Internal.Actions.ScaleTo(this._actors[o],e,i,n,s));return this},e.prototype.scaleBy=function(e,i,n){var s=0,o=this._queues.length;for(s;o>s;s++)this._queues[s].add(new t.Internal.Actions.ScaleBy(this._actors[s],e,i,n));return this},e.prototype.blink=function(e,i,n){void 0===n&&(n=1);var s=0,o=this._queues.length;for(s;o>s;s++)this._queues[s].add(new t.Internal.Actions.Blink(this._actors[s],e,i,n));return this},e.prototype.fade=function(e,i){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.Fade(this._actors[n],e,i));return this},e.prototype.delay=function(e){var i=0,n=this._queues.length;for(i;n>i;i++)this._queues[i].add(new t.Internal.Actions.Delay(this._actors[i],e));return this},e.prototype.die=function(){var e=0,i=this._queues.length;for(e;i>e;e++)this._queues[e].add(new t.Internal.Actions.Die(this._actors[e]));return this},e.prototype.callMethod=function(e){var i=0,n=this._queues.length;for(i;n>i;i++)this._queues[i].add(new t.Internal.Actions.CallMethod(this._actors[i],e));return this},e.prototype.repeat=function(e){if(!e)return this.repeatForever(),this;var i=0,n=this._queues.length;for(i;n>i;i++)this._queues[i].add(new t.Internal.Actions.Repeat(this._actors[i],e,this._actors[i].actionQueue.getActions()));return this},e.prototype.repeatForever=function(){var e=0,i=this._queues.length;for(e;i>e;e++)this._queues[e].add(new t.Internal.Actions.RepeatForever(this._actors[e],this._actors[e].actionQueue.getActions()));return this},e.prototype.follow=function(e,i){var n=0,s=this._queues.length;for(n;s>n;n++)void 0===i?this._queues[n].add(new t.Internal.Actions.Follow(this._actors[n],e)):this._queues[n].add(new t.Internal.Actions.Follow(this._actors[n],e,i));return this},e.prototype.meet=function(e,i){var n=0,s=this._queues.length;for(n;s>n;n++)void 0===i?this._queues[n].add(new t.Internal.Actions.Meet(this._actors[n],e)):this._queues[n].add(new t.Internal.Actions.Meet(this._actors[n],e,i));return this},e.prototype.asPromise=function(){var e=this,i=this._queues.map(function(i,n){var s=new t.Promise;return i.add(new t.Internal.Actions.CallMethod(e._actors[n],function(){s.resolve()})),s});return t.Promise.join.apply(this,i)},e}();t.ActionContext=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,n){if(e.call(this),this.name=i,this.scene=n,this._logger=t.Logger.getInstance(),this._members=[],this.actions=new t.ActionContext,null==n)this._logger.error("Invalid constructor arguments passed to Group: ",i,", scene must not be null!");else{var s=n.groups[i];s&&this._logger.warn("Group with name",i,"already exists. This new group will replace it."),n.groups[i]=this}}return __extends(i,e),i.prototype.add=function(e){e instanceof t.Actor&&(e=[].concat(e));var i,n=0,s=e.length;for(n;s>n;n++)i=this.getMembers().indexOf(e[n]),-1===i&&(this._members.push(e[n]),this.scene.add(e[n]),this.actions.addActorToContext(e[n]),this.eventDispatcher.wire(e[n].eventDispatcher))},i.prototype.remove=function(t){var e=this._members.indexOf(t);e>-1&&(this._members.splice(e,1),this.actions.removeActorFromContext(t),this.eventDispatcher.unwire(t.eventDispatcher))},i.prototype.move=function(e){var i=0,n=this.getMembers(),s=n.length;if(1===arguments.length&&e instanceof t.Vector)for(i;s>i;i++)n[i].x+=e.x,n[i].y+=e.y;else if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var o=arguments[0],r=arguments[1];for(i;s>i;i++)n[i].x+=o,n[i].y+=r}else this._logger.error("Invalid arguments passed to group move",this.name,"args:",arguments)},i.prototype.rotate=function(){if("number"==typeof arguments[0]){var t=arguments[0],e=0,i=this.getMembers(),n=i.length;for(e;n>e;e++)i[e].rotation+=t}else this._logger.error("Invalid arguments passed to group rotate",this.name,"args:",arguments)},i.prototype.on=function(t,e){this.eventDispatcher.subscribe(t,e)},i.prototype.off=function(t,e){this.eventDispatcher.unsubscribe(t,e)},i.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},i.prototype.contains=function(t){return this.getMembers().indexOf(t)>-1},i.prototype.getMembers=function(){return this._members},i.prototype.getRandomMember=function(){return this._members[Math.floor(Math.random()*this._members.length)]},i.prototype.getBounds=function(){return this.getMembers().map(function(t){return t.getBounds()}).reduce(function(t,e){return t.combine(e)})},i}(t.Class);t.Group=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(t){this._getComparable=t}return t.prototype.find=function(t){return this._find(this._root,t)},t.prototype._find=function(t,e){return null==t?!1:this._getComparable.call(e)===t.getKey()?t.getData().indexOf(e)>-1?!0:!1:this._getComparable.call(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e)},t.prototype.get=function(t){return this._get(this._root,t)},t.prototype._get=function(t,e){return null==t?[]:e===t.getKey()?t.getData():t.getKey()>e?this._get(t.getLeft(),e):this._get(t.getRight(),e)},t.prototype.add=function(t){return null==this._root?(this._root=new i(this._getComparable.call(t),[t],null,null),!0):this._insert(this._root,t)},t.prototype._insert=function(t,e){return null!=t?this._getComparable.call(e)===t.getKey()?t.getData().indexOf(e)>-1?!1:(t.getData().push(e),!0):this._getComparable.call(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new i(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new i(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getRight(),e):!1},t.prototype.removeByComparable=function(t){this._root=this._remove(this._root,t)},t.prototype._remove=function(t,e){if(null==t)return null;if(this._getComparable.call(e)!==t.getKey())return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);var i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var n=this._findMinNode(t.getRight());return t.setKey(n.getKey()),t.setData(n.getData()),t.setRight(this._cleanup(t.getRight(),n)),t}return t}},t.prototype._cleanup=function(t,e){var i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var n=this._findMinNode(t.getRight());return t.setKey(n.getKey()),t.setData(n.getData()),t.setRight(this._cleanup(t.getRight(),n)),t}return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)},t.prototype._findMinNode=function(t){for(var e=t;null!=e.getLeft();)e=e.getLeft();return e},t.prototype.list=function(){var t=[];return this._list(this._root,t),t},t.prototype._list=function(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach(function(t){e.push(t)}),this._list(t.getRight(),e))},t}();t.SortedList=e;var i=function(){function t(t,e,i,n){this._key=t,this._data=e,this._left=i,this._right=n}return t.prototype.getKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getLeft=function(){return this._left},t.prototype.setLeft=function(t){this._left=t},t.prototype.getRight=function(){return this._right},t.prototype.setRight=function(t){this._right=t},t}();t.BinaryTreeNode=i;var n=function(){function t(t){this._key=0,this._key=t}return t.prototype.getTheKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t}();t.MockedElement=n})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i){e.call(this),this.children=[],this.tileMaps=[],this.groups={},this.uiActors=[],this.isInitialized=!1,this._sortedDrawingTree=new t.SortedList(t.Actor.prototype.getZIndex),this._collisionResolver=new t.DynamicTreeCollisionResolver,this._killQueue=[],this._timers=[],this._cancelQueue=[],this._logger=t.Logger.getInstance(),this.camera=new t.BaseCamera,i&&this.camera.setFocus(i.width/2,i.height/2)
}return __extends(i,e),i.prototype.onInitialize=function(t){this.camera&&this.camera.setFocus(t.width/2,t.height/2),this._logger.debug("Scene.onInitialize",this,t)},i.prototype.onActivate=function(){this._logger.debug("Scene.onActivate",this)},i.prototype.onDeactivate=function(){this._logger.debug("Scene.onDeactivate",this)},i.prototype.publish=function(t,e){var i=0,n=this.children.length;for(i;n>i;i++)this.children[i].triggerEvent(t,e)},i.prototype.update=function(t,e){var i,n;for(i=0,n=this.uiActors.length;n>i;i++)this.uiActors[i].update(t,e);for(i=0,n=this.tileMaps.length;n>i;i++)this.tileMaps[i].update(t,e);for(i=0,n=this.children.length;n>i;i++)this.children[i].update(t,e);this._collisionResolver&&(this._collisionResolver.update(this.children),this._collisionResolver.evaluate(this.children));var s;for(i=0,n=this._killQueue.length;n>i;i++)s=this.children.indexOf(this._killQueue[i]),s>-1&&this.children.splice(s,1);for(this._killQueue.length=0,i=0,n=this._cancelQueue.length;n>i;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0,this._timers=this._timers.filter(function(t){return t.update(e),!t.complete})},i.prototype.draw=function(t,e){t.save(),this.camera&&this.camera.update(t,e);var i,n;for(i=0,n=this.tileMaps.length;n>i;i++)this.tileMaps[i].draw(t,e);var s=this._sortedDrawingTree.list();for(i=0,n=s.length;n>i;i++)s[i].visible&&!s[i].isOffScreen&&s[i].draw(t,e);for(this.engine&&this.engine.isDebug&&(t.strokeStyle="yellow",this.debugDraw(t)),t.restore(),i=0,n=this.uiActors.length;n>i;i++)this.uiActors[i].visible&&this.uiActors[i].draw(t,e);if(this.engine&&this.engine.isDebug)for(i=0,n=this.uiActors.length;n>i;i++)this.uiActors[i].debugDraw(t)},i.prototype.debugDraw=function(t){var e,i;for(e=0,i=this.tileMaps.length;i>e;e++)this.tileMaps[e].debugDraw(t);for(e=0,i=this.children.length;i>e;e++)this.children[e].debugDraw(t)},i.prototype.contains=function(t){return this.children.indexOf(t)>-1},i.prototype.add=function(e){return e instanceof t.UIActor?(this.addUIActor(e),void 0):(e instanceof t.Actor&&(this.addChild(e),this._sortedDrawingTree.add(e)),e instanceof t.Timer&&this.addTimer(e),e instanceof t.TileMap&&this.addTileMap(e),void 0)},i.prototype.remove=function(e){return e instanceof t.UIActor?(this.removeUIActor(e),void 0):(e instanceof t.Actor&&(this._collisionResolver.remove(e),this.removeChild(e)),e instanceof t.Timer&&this.removeTimer(e),e instanceof t.TileMap&&this.removeTileMap(e),void 0)},i.prototype.addUIActor=function(t){this.uiActors.push(t),t.scene=this},i.prototype.removeUIActor=function(t){var e=this.uiActors.indexOf(t);e>-1&&this.uiActors.splice(e,1)},i.prototype.addChild=function(t){this._collisionResolver.register(t),t.scene=this,this.children.push(t),this._sortedDrawingTree.add(t),t.parent=this.actor},i.prototype.addTileMap=function(t){this.tileMaps.push(t)},i.prototype.removeTileMap=function(t){var e=this.tileMaps.indexOf(t);e>-1&&this.tileMaps.splice(e,1)},i.prototype.removeChild=function(t){this._collisionResolver.remove(t),this._killQueue.push(t),t.parent=null},i.prototype.addTimer=function(t){return this._timers.push(t),t.scene=this,t},i.prototype.removeTimer=function(t){var e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t},i.prototype.cancelTimer=function(t){return this._cancelQueue.push(t),t},i.prototype.isTimerActive=function(t){return this._timers.indexOf(t)>-1},i.prototype.createGroup=function(e){return new t.Group(e,this)},i.prototype.getGroup=function(t){return this.groups[t]},i.prototype.removeGroup=function(e){"string"==typeof e?delete this.groups[e]:e instanceof t.Group?delete this.groups[e.name]:this._logger.error("Invalid arguments to removeGroup",e)},i.prototype.cleanupDrawTree=function(t){this._sortedDrawingTree.removeByComparable(t)},i.prototype.updateDrawTree=function(t){this._sortedDrawingTree.add(t)},i}(t.Class);t.Scene=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(){}return t.Linear=function(t,e,i,n){return i-=e,i*t/n+e},t.EaseInQuad=function(t,e,i,n){t/=n},t.EaseOutQuad=function(t,e,i,n){return t/=n,-i*t*(t-2)+e},t.EaseInOutQuad=function(t,e,i,n){return i-=e,t/=n/2,1>t?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)},t.EaseInCubic=function(t,e,i,n){return i-=e,t/=n,i*t*t*t+e},t.EaseOutCubic=function(t,e,i,n){return i-=e,t/=n,i*(t*t*t+1)+e},t.EaseInOutCubic=function(t,e,i,n){return i-=e,t/=n/2,1>t?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},t}();t.EasingFunctions=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(n,s,o,r,h){e.call(this),this.id=i.maxId++,this.x=0,this.y=0,this._height=0,this._width=0,this.rotation=0,this.rx=0,this.scale=new t.Vector(1,1),this.sx=0,this.sy=0,this.dx=0,this.dy=0,this.ax=0,this.ay=0,this.isOffScreen=!1,this.visible=!0,this.opacity=1,this.previousOpacity=1,this.actions=new t.ActionContext(this),this.logger=t.Logger.getInstance(),this.scene=null,this.parent=null,this.children=[],this.collisionType=0,this.collisionGroups=[],this._collisionHandlers={},this._isInitialized=!1,this.frames={},this.currentDrawing=null,this.centerDrawingX=!0,this.centerDrawingY=!0,this.traits=[],this.enableCapturePointer=!1,this.capturePointer={captureMoveEvents:!1},this._zIndex=0,this._isKilled=!1,this.x=n||0,this.y=s||0,this._width=o||0,this._height=r||0,h&&(this.color=h.clone(),this.opacity=h.a),this.traits.push(new t.Traits.Movement),this.traits.push(new t.Traits.OffscreenCulling),this.traits.push(new t.Traits.CapturePointer),this.actionQueue=new t.Internal.Actions.ActionQueue(this),this.anchor=new t.Point(.5,.5)}return __extends(i,e),i.prototype.onInitialize=function(){},i.prototype._checkForPointerOptIn=function(t){!t||"pointerdown"!==t.toLowerCase()&&"pointerdown"!==t.toLowerCase()&&"pointermove"!==t.toLowerCase()||(this.enableCapturePointer=!0,"pointermove"===t.toLowerCase()&&(this.capturePointer.captureMoveEvents=!0))},i.prototype.addEventListener=function(t,i){this._checkForPointerOptIn(t),e.prototype.addEventListener.call(this,t,i)},i.prototype.on=function(t,e){this._checkForPointerOptIn(t),this.eventDispatcher.subscribe(t,e)},i.prototype.kill=function(){this.scene?(this.scene.remove(this),this._isKilled=!0):this.logger.warn("Cannot kill actor, it was never added to the Scene")},i.prototype.isKilled=function(){return this._isKilled},i.prototype.addChild=function(e){e.collisionType=0,t.Util.addItemToArray(e,this.children)&&(e.parent=this)},i.prototype.removeChild=function(e){t.Util.removeItemToArray(e,this.children)&&(e.parent=null)},i.prototype.setDrawing=function(t){t=""+t,this.currentDrawing!==this.frames[t]&&this.frames[t].reset(),this.currentDrawing=this.frames[t]},i.prototype.addDrawing=function(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1])):(arguments[0]instanceof t.Sprite&&this.addDrawing("default",arguments[0]),arguments[0]instanceof t.Texture&&this.addDrawing("default",arguments[0].asSprite()))},i.prototype.getZIndex=function(){return this._zIndex},i.prototype.setZIndex=function(t){this.scene.cleanupDrawTree(this),this._zIndex=t,this.scene.updateDrawTree(this)},i.prototype.triggerEvent=function(t,e){this.eventDispatcher.publish(t,e)},i.prototype.addCollisionGroup=function(t){this.collisionGroups.push(t)},i.prototype.removeCollisionGroup=function(t){var e=this.collisionGroups.indexOf(t);-1!==e&&this.collisionGroups.splice(e,1)},i.prototype.getCenter=function(){return new t.Vector(this.x+this.getWidth()/2-this.anchor.x*this.getWidth(),this.y+this.getHeight()/2-this.anchor.y*this.getHeight())},i.prototype.getWidth=function(){return this._width*this.scale.x},i.prototype.setWidth=function(t){this._width=t/this.scale.x},i.prototype.getHeight=function(){return this._height*this.scale.y},i.prototype.setHeight=function(t){this._height=t/this.scale.y},i.prototype.setCenterDrawing=function(t){this.centerDrawingY=t,this.centerDrawingX=t},i.prototype.getLeft=function(){return this.x},i.prototype.getRight=function(){return this.x+this.getWidth()},i.prototype.getTop=function(){return this.y},i.prototype.getBottom=function(){return this.y+this.getHeight()},i.prototype.getWorldX=function(){return this.parent?this.x*this.parent.scale.x+this.parent.getWorldX():this.x},i.prototype.getWorldY=function(){return this.parent?this.y*this.parent.scale.y+this.parent.getWorldY():this.y},i.prototype.getGlobalScale=function(){if(!this.parent)return new t.Point(this.scale.x,this.scale.y);var e=this.parent.getGlobalScale();return new t.Point(this.scale.x*e.x,this.scale.y*e.y)},i.prototype.getBounds=function(){var e=this._getCalculatedAnchor();return new t.BoundingBox(this.getWorldX()-e.x,this.getWorldY()-e.y,this.getWorldX()+this.getWidth()-e.x,this.getWorldY()+this.getHeight()-e.y)},i.prototype.contains=function(e,i){return this.getBounds().contains(new t.Point(e,i))},i.prototype.getSideFromIntersect=function(t){return t?Math.abs(t.x)>Math.abs(t.y)?0>t.x?4:3:0>t.y?2:1:0},i.prototype.collidesWithSide=function(t){var e=this.collides(t);return e?Math.abs(e.x)>Math.abs(e.y)?this.x<t.x?4:3:this.y<t.y?2:1:0},i.prototype.collides=function(t){var e=this.getBounds(),i=t.getBounds(),n=e.collides(i);return n},i.prototype.onCollidesWith=function(t,e){this._collisionHandlers[t]||(this._collisionHandlers[t]=[]),this._collisionHandlers[t].push(e)},i.prototype.getCollisionHandlers=function(){return this._collisionHandlers},i.prototype.removeCollidesWith=function(t){this._collisionHandlers[t]=[]},i.prototype.within=function(t,e){return e>=Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},i.prototype.clearActions=function(){this.actionQueue.clearActions()},i.prototype.easeTo=function(e,i,n,s){return void 0===s&&(s=t.EasingFunctions.Linear),this.actionQueue.add(new t.Internal.Actions.EaseTo(this,e,i,n,s)),this},i.prototype.moveTo=function(e,i,n){return this.actionQueue.add(new t.Internal.Actions.MoveTo(this,e,i,n)),this},i.prototype.moveBy=function(e,i,n){return this.actionQueue.add(new t.Internal.Actions.MoveBy(this,e,i,n)),this},i.prototype.rotateTo=function(e,i){return this.actionQueue.add(new t.Internal.Actions.RotateTo(this,e,i)),this},i.prototype.rotateBy=function(e,i){return this.actionQueue.add(new t.Internal.Actions.RotateBy(this,e,i)),this},i.prototype.scaleTo=function(e,i,n,s){return this.actionQueue.add(new t.Internal.Actions.ScaleTo(this,e,i,n,s)),this},i.prototype.scaleBy=function(e,i,n){return this.actionQueue.add(new t.Internal.Actions.ScaleBy(this,e,i,n)),this},i.prototype.blink=function(e,i,n){return void 0===n&&(n=1),this.actionQueue.add(new t.Internal.Actions.Blink(this,e,i,n)),this},i.prototype.fade=function(e,i){return this.actionQueue.add(new t.Internal.Actions.Fade(this,e,i)),this},i.prototype.delay=function(e){return this.actionQueue.add(new t.Internal.Actions.Delay(this,e)),this},i.prototype.die=function(){return this.actionQueue.add(new t.Internal.Actions.Die(this)),this},i.prototype.callMethod=function(e){return this.actionQueue.add(new t.Internal.Actions.CallMethod(this,e)),this},i.prototype.repeat=function(e){return e?(this.actionQueue.add(new t.Internal.Actions.Repeat(this,e,this.actionQueue.getActions())),this):(this.repeatForever(),this)},i.prototype.repeatForever=function(){return this.actionQueue.add(new t.Internal.Actions.RepeatForever(this,this.actionQueue.getActions())),this},i.prototype.follow=function(e,i){return i===void 0?this.actionQueue.add(new t.Internal.Actions.Follow(this,e)):this.actionQueue.add(new t.Internal.Actions.Follow(this,e,i)),this},i.prototype.meet=function(e,i){return i===void 0?this.actionQueue.add(new t.Internal.Actions.Meet(this,e)):this.actionQueue.add(new t.Internal.Actions.Meet(this,e,i)),this},i.prototype.asPromise=function(){var e=new t.Promise;return this.callMethod(function(){e.resolve()}),e},i.prototype._getCalculatedAnchor=function(){return new t.Point(this.getWidth()*this.anchor.x,this.getHeight()*this.anchor.y)},i.prototype.update=function(e,i){this._isInitialized||(this.onInitialize(e),this.eventDispatcher.publish("initialize",new t.InitializeEvent(e)),this._isInitialized=!0);var n=this.eventDispatcher;this.actionQueue.update(i);for(var s=0;this.traits.length>s;s++)this.traits[s].update(this,e,i);n.publish(t.EventType[5],new t.UpdateEvent(i))},i.prototype.draw=function(e,i){var n=this._getCalculatedAnchor();if(e.save(),e.scale(this.scale.x,this.scale.y),e.translate(this.x,this.y),e.rotate(this.rotation),this.previousOpacity!==this.opacity){for(var s in this.frames)this.frames[s].addEffect(new t.Effects.Opacity(this.opacity));this.previousOpacity=this.opacity}if(this.currentDrawing){var o=0,r=0;this.centerDrawingX&&(o=(this.currentDrawing.width*this.currentDrawing.scale.x-this.getWidth())/2-this.currentDrawing.width*this.currentDrawing.scale.x*this.currentDrawing.anchor.x),this.centerDrawingY&&(r=(this.currentDrawing.height*this.currentDrawing.scale.y-this.getHeight())/2-this.currentDrawing.height*this.currentDrawing.scale.y*this.currentDrawing.anchor.y),this.currentDrawing.draw(e,-n.x-o,-n.y-r)}else this.color&&(e.fillStyle=""+this.color,e.fillRect(-n.x,-n.y,this._width,this._height));for(var h=0;this.children.length>h;h++)this.children[h].draw(e,i);e.restore()},i.prototype.debugDraw=function(e){var i=this.getBounds();i.debugDraw(e),e.fillText("id: "+this.id,i.left+3,i.top+10),e.fillStyle=""+t.Color.Yellow,e.beginPath(),e.arc(this.getWorldX(),this.getWorldY(),3,0,2*Math.PI),e.closePath(),e.fill();for(var n=0;this.traits.length>n;n++)this.traits[n]instanceof t.Traits.OffscreenCulling&&this.traits[n].cullingBox.debugDraw(e);e.save(),e.translate(this.x,this.y),e.rotate(this.rotation);for(var s=0;this.children.length>s;s++)this.children[s].debugDraw(e);e.restore()},i.maxId=0,i}(t.Class);t.Actor=e,function(t){t[t.PreventCollision=0]="PreventCollision",t[t.Passive=1]="Passive",t[t.Active=2]="Active",t[t.Elastic=3]="Elastic",t[t.Fixed=4]="Fixed"}(t.CollisionType||(t.CollisionType={})),t.CollisionType})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Fatal=4]="Fatal"})(t.LogLevel||(t.LogLevel={}));var e=t.LogLevel,i=function(){function t(){if(this._appenders=[],this.defaultLevel=1,t._instance)throw Error("Logger is a singleton");return t._instance=this,t._instance.addAppender(new n),t._instance}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.addAppender=function(t){this._appenders.push(t)},t.prototype.clearAppenders=function(){this._appenders.length=0},t.prototype._log=function(t,e){null==t&&(t=this.defaultLevel);var i=0,n=this._appenders.length;for(i;n>i;i++)t>=this.defaultLevel&&this._appenders[i].log(t,e)},t.prototype.debug=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];this._log(0,t)},t.prototype.info=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];this._log(1,t)},t.prototype.warn=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];this._log(2,t)},t.prototype.error=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];this._log(3,t)},t.prototype.fatal=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];this._log(4,t)},t._instance=null,t}();t.Logger=i;var n=function(){function t(){}return t.prototype.log=function(t,i){if(console||console.log||!console.warn||!console.error){var n=[];n.unshift.apply(n,i),n.unshift("["+e[t]+"] : "),2>t?console.log.apply?console.log.apply(console,n):console.log(n.join(" ")):3>t?console.warn.apply?console.warn.apply(console,n):console.warn(n.join(" ")):console.error.apply?console.error.apply(console,n):console.error(n.join(" "))}},t}();t.ConsoleAppender=n;var s=function(){function t(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return t.prototype.log=function(t,i){var n=i.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+e[t]+"] : "+n);for(var s=10,o=1,r=0;this._messages.length>r;r++)this._ctx.fillStyle="rgba(255,255,255,"+o.toFixed(2)+")",this._ctx.fillText(this._messages[r],200,s),s+=10,o=o>0?o-.05:0},t}();t.ScreenAppender=s})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Collision=0]="Collision",t[t.EnterViewPort=1]="EnterViewPort",t[t.ExitViewPort=2]="ExitViewPort",t[t.Blur=3]="Blur",t[t.Focus=4]="Focus",t[t.Update=5]="Update",t[t.Activate=6]="Activate",t[t.Deactivate=7]="Deactivate",t[t.Initialize=8]="Initialize"})(t.EventType||(t.EventType={})),t.EventType;var e=function(){function t(){}return t}();t.GameEvent=e;var i=function(t){function e(e,i){t.call(this),this.topic=e,this.handler=i}return __extends(e,t),e}(e);t.SubscribeEvent=i;var n=function(t){function e(e,i){t.call(this),this.topic=e,this.handler=i}return __extends(e,t),e}(e);t.UnsubscribeEvent=n;var s=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.VisibleEvent=s;var o=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.HiddenEvent=o;var r=function(t){function e(e,i,n,s){t.call(this),this.actor=e,this.other=i,this.side=n,this.intersection=s}return __extends(e,t),e}(e);t.CollisionEvent=r;var h=function(t){function e(e){t.call(this),this.delta=e}return __extends(e,t),e}(e);t.UpdateEvent=h;var a=function(t){function e(e){t.call(this),this.engine=e}return __extends(e,t),e}(e);t.InitializeEvent=a;var c=function(t){function e(e){t.call(this),this.oldScene=e}return __extends(e,t),e}(e);t.ActivateEvent=c;var u=function(t){function e(e){t.call(this),this.newScene=e}return __extends(e,t),e}(e);t.DeactivateEvent=u;var l=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.ExitViewPortEvent=l;var p=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.EnterViewPortEvent=p})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this._handlers={},this._wiredEventDispatchers=[],this._log=t.Logger.getInstance(),this._target=e}return e.prototype.publish=function(e,i){if(e){e=e.toLowerCase();var n=this._target;i||(i=new t.GameEvent),i.target=n;var s,o;if(this._handlers[e])for(s=0,o=this._handlers[e].length,s;o>s;s++)this._handlers[e][s].call(n,i);for(s=0,o=this._wiredEventDispatchers.length,s;o>s;s++)this._wiredEventDispatchers[s].publish(e,i)}},e.prototype.emit=function(t,e){this.publish(t,e)},e.prototype.subscribe=function(e,i){e=e.toLowerCase(),this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(i),"unsubscribe"!==e&&"subscribe"!==e&&this.emit("subscribe",new t.SubscribeEvent(e,i))},e.prototype.unsubscribe=function(e,i){e=e.toLowerCase();var n=this._handlers[e];if(n)if(i){var s=n.indexOf(i);this._handlers[e].splice(s,1)}else this._handlers[e].length=0;"unsubscribe"!==e&&"subscribe"!==e&&this.emit("unsubscribe",new t.UnsubscribeEvent(e,i))},e.prototype.wire=function(t){t._wiredEventDispatchers.push(this)},e.prototype.unwire=function(t){var e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)},e}();t.EventDispatcher=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=null!=n?n:1}return t.fromRGB=function(e,i,n,s){return new t(e,i,n,s)},t.fromHex=function(e){var i=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,n=null;if(n=e.match(i)){var s=parseInt(n[1],16),o=parseInt(n[2],16),r=parseInt(n[3],16),h=1;return n[4]&&(h=parseInt(n[4],16)/255),new t(s,o,r,h)}throw Error("Invalid hex string: "+e)},t.fromHSL=function(t,e,n,s){void 0===s&&(s=1);var o=new i(t,e,n,s);return o.toRGBA()},t.prototype.lighten=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=e.l*t,e.toRGBA()},t.prototype.darken=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()},t.prototype.saturate=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()},t.prototype.desaturate=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()},t.prototype.mulitiply=function(e){var i=255*(e.r/255*this.r/255),n=255*(e.g/255*this.g/255),s=255*(e.b/255*this.b/255),o=e.a*this.a;return new t(i,n,s,o)},t.prototype.screen=function(t){var e=t.invert(),i=t.invert();return e.mulitiply(i).invert()},t.prototype.invert=function(){return new t(255-this.r,255-this.g,255-this.b,1-this.a)},t.prototype.average=function(e){var i=(e.r+this.r)/2,n=(e.g+this.g)/2,s=(e.b+this.b)/2,o=(e.a+this.a)/2;return new t(i,n,s,o)},t.prototype.toString=function(){var t=this.r.toFixed(0)+""+", "+(this.g.toFixed(0)+"")+", "+(this.b.toFixed(0)+"");return void 0!==this.a||null!==this.a?"rgba("+t+", "+(this.a+"")+")":"rgb("+t+")"},t.prototype.fillStyle=function(){return""+this},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.Black=t.fromHex("#000000"),t.White=t.fromHex("#FFFFFF"),t.Gray=t.fromHex("#808080"),t.LightGray=t.fromHex("#D3D3D3"),t.DarkGray=t.fromHex("#A9A9A9"),t.Yellow=t.fromHex("#FFFF00"),t.Orange=t.fromHex("#FFA500"),t.Red=t.fromHex("#FF0000"),t.Vermillion=t.fromHex("#FF5B31"),t.Rose=t.fromHex("#FF007F"),t.Magenta=t.fromHex("#FF00FF"),t.Violet=t.fromHex("#7F00FF"),t.Blue=t.fromHex("#0000FF"),t.Azure=t.fromHex("#007FFF"),t.Cyan=t.fromHex("#00FFFF"),t.Viridian=t.fromHex("#59978F"),t.Green=t.fromHex("#00FF00"),t.Chartreuse=t.fromHex("#7FFF00"),t.Transparent=t.fromHex("#FFFFFF00"),t}();t.Color=e;var i=function(){function t(t,e,i,n){this.h=t,this.s=e,this.l=i,this.a=n}return t.fromRGBA=function(e,i,n,s){e/=255,i/=255,n/=255;var o,r,h=Math.max(e,i,n),a=Math.min(e,i,n),c=(h+a)/2;if(h===a)o=r=0;else{var u=h-a;switch(r=c>.5?u/(2-h-a):u/(h+a),h){case e:o=(i-n)/u+(n>i?6:0);break;case i:o=(n-e)/u+2;break;case n:o=(e-i)/u+4}o/=6}return new t(o,r,c,s)},t.prototype.toRGBA=function(){function t(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+6*(e-t)*(2/3-i):t}var i,n,s;if(0===this.s)i=n=s=this.l;else{var o=.5>this.l?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-o;i=t(r,o,this.h+1/3),n=t(r,o,this.h),s=t(r,o,this.h-1/3)}return new e(255*i,255*n,255*s,this.a)},t}()})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,n,s,o){e.call(this,i,n,s,o),this.traits=[],this.traits.push(new t.Traits.Movement),this.traits.push(new t.Traits.CapturePointer),this.anchor.setTo(0,0),this.collisionType=0,this.enableCapturePointer=!0}return __extends(i,e),i.prototype.onInitialize=function(t){this._engine=t},i.prototype.contains=function(i,n,s){if(void 0===s&&(s=!0),s)return e.prototype.contains.call(this,i,n);var o=this._engine.worldToScreenCoordinates(new t.Point(i,n));return e.prototype.contains.call(this,o.x,o.y)},i}(t.Actor);t.UIActor=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,n,s,o,r,h){e.call(this,i,n,s,o),this._action=function(){},this.repeats=1,this.target=null,this.repeats=h||this.repeats,this._action=r||this._action,this.collisionType=0,this.eventDispatcher=new t.EventDispatcher(this),this.actionQueue=new t.Internal.Actions.ActionQueue(this)}return __extends(i,e),i.prototype.update=function(t,e){if(this.actionQueue.update(e),this.x+=this.dx*e/1e3,this.y+=this.dy*e/1e3,this.rotation+=this.rx*e/1e3,this.scale.x+=this.sx*e/1e3,this.scale.y+=this.sy*e/1e3,this.target)this.collides(this.target)&&this._dispatchAction();else for(var i=0;t.currentScene.children.length>i;i++){var n=t.currentScene.children[i];n!==this&&0!==n.collisionType&&this.collides(n)&&this._dispatchAction()}0===this.repeats&&this.kill()},i.prototype._dispatchAction=function(){this._action.call(this),this.repeats--},i.prototype.draw=function(){},i.prototype.debugDraw=function(i){e.prototype.debugDraw.call(this,i),i.save(),i.translate(this.x,this.y);var n=this.getBounds();n.left=n.left-this.getWorldX(),n.right=n.right-this.getWorldX(),n.top=n.top-this.getWorldY(),n.bottom=n.bottom-this.getWorldY(),i.fillStyle=""+t.Color.Violet,i.strokeStyle=""+t.Color.Violet,i.fillText("Trigger",10,10),n.debugDraw(i),i.restore()},i}(t.Actor);t.Trigger=e})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Circle=0]="Circle",t[t.Rectangle=1]="Rectangle"})(t.EmitterType||(t.EmitterType={})),t.EmitterType;var e=function(){function e(e,i,n,s,o,r,h,a,c,u){this.position=new t.Vector(0,0),this.velocity=new t.Vector(0,0),this.acceleration=new t.Vector(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=t.Color.White.clone(),this.endColor=t.Color.White.clone(),this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=t.Color.White.clone(),this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.emitter=e,this.life=i||this.life,this.opacity=n||this.opacity,this.endColor=o||this.endColor.clone(),this.beginColor=s||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=r||this.position,this.velocity=h||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=c||0,this.endSize=u||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return e.prototype.kill=function(){this.emitter.removeParticle(this)},e.prototype.update=function(e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,0>this.life&&this.kill(),this.fadeFlag&&(this.opacity=t.Util.clamp(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=t.Util.clamp(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=t.Util.clamp(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=t.Util.clamp(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=t.Util.clamp(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=t.Util.clamp(this.opacity,1e-4,1),this.focus){var i=this.focus.minus(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(i)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI))},e.prototype.draw=function(e){return this.particleSprite?(this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),this.particleSprite.draw(e,this.position.x,this.position.y),void 0):(this._currentColor.a=t.Util.clamp(this.opacity,1e-4,1),e.fillStyle=""+this._currentColor,e.beginPath(),e.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),e.fill(),e.closePath(),void 0)},e}();t.Particle=e;var i=function(i){function n(e,n,s,o){i.call(this,e,n,s,o,t.Color.White),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=null,this.deadParticles=null,this.minVel=0,this.maxVel=0,this.acceleration=new t.Vector(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.opacity=1,this.fadeFlag=!1,this.focus=null,this.focusAccel=1,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=t.Color.White,this.endColor=t.Color.White,this.particleSprite=null,this.emitterType=1,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this.collisionType=0,this.particles=new t.Util.Collection,this.deadParticles=new t.Util.Collection;for(var r in this.traits)this.traits[r]instanceof t.Traits.OffscreenCulling&&this.traits.splice(r,1)}return __extends(n,i),n.prototype.removeParticle=function(t){this.deadParticles.push(t)},n.prototype.emit=function(t){for(var e=0;t>e;e++)this.particles.push(this._createParticle())},n.prototype.clearParticles=function(){this.particles.clear()},n.prototype._createParticle=function(){var i=0,n=0,s=t.Util.randomInRange(this.minAngle,this.maxAngle),o=t.Util.randomInRange(this.minVel,this.maxVel),r=this.startSize||t.Util.randomInRange(this.minSize,this.maxSize),h=o*Math.cos(s),a=o*Math.sin(s);if(1===this.emitterType)i=t.Util.randomInRange(this.x,this.x+this.getWidth()),n=t.Util.randomInRange(this.y,this.y+this.getHeight());else if(0===this.emitterType){var c=t.Util.randomInRange(0,this.radius);i=c*Math.cos(s)+this.x,n=c*Math.sin(s)+this.y}var u=new e(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new t.Vector(i,n),new t.Vector(h,a),this.acceleration,this.startSize,this.endSize);return u.fadeFlag=this.fadeFlag,u.particleSize=r,this.particleSprite&&(u.particleSprite=this.particleSprite),u.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(u.currentRotation=t.Util.randomInRange(0,2*Math.PI)),this.focus&&(u.focus=this.focus.add(new t.Vector(this.x,this.y)),u.focusAccel=this.focusAccel),u},n.prototype.update=function(t,e){var n=this;i.prototype.update.call(this,t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emit(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(function(t){return t.update(e)}),this.deadParticles.forEach(function(t){return n.particles.removeElement(t)}),this.deadParticles.clear()},n.prototype.draw=function(t){this.particles.forEach(function(e){return e.draw(t)})},n.prototype.debugDraw=function(e){i.prototype.debugDraw.call(this,e),e.fillStyle=""+t.Color.Black,e.fillText("Particles: "+this.particles.count(),this.x,this.y+20),this.focus&&(e.fillRect(this.focus.x+this.x,this.focus.y+this.y,3,3),t.Util.drawLine(e,"yellow",this.focus.x+this.x,this.focus.y+this.y,i.prototype.getCenter.call(this).x,i.prototype.getCenter.call(this).y),e.fillText("Focus",this.focus.x+this.x,this.focus.y+this.y))},n}(t.Actor);t.ParticleEmitter=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,n,s){this.currentFrame=0,this._oldTime=Date.now(),this.anchor=new t.Point(0,0),this.rotation=0,this.scale=new t.Point(1,1),this.loop=!1,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.sprites=i,this.speed=n,this._engine=e,null!=s&&(this.loop=s),this.height=i[0]?i[0].height:0,this.width=i[0]?i[0].width:0}return e.prototype.opacity=function(e){this.addEffect(new t.Effects.Opacity(e))},e.prototype.grayscale=function(){this.addEffect(new t.Effects.Grayscale)},e.prototype.invert=function(){this.addEffect(new t.Effects.Invert)},e.prototype.fill=function(e){this.addEffect(new t.Effects.Fill(e))},e.prototype.colorize=function(e){this.addEffect(new t.Effects.Colorize(e))},e.prototype.lighten=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Lighten(e))},e.prototype.darken=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Darken(e))},e.prototype.saturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Saturate(e))},e.prototype.desaturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Desaturate(e))},e.prototype.addEffect=function(t){for(var e in this.sprites)this.sprites[e].addEffect(t)},e.prototype.removeEffect=function(t){for(var e in this.sprites)this.sprites[e].removeEffect(t)},e.prototype.clearEffects=function(){for(var t in this.sprites)this.sprites[t].clearEffects()},e.prototype._setAnchor=function(t){for(var e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)},e.prototype._setRotation=function(t){for(var e in this.sprites)this.sprites[e].rotation=t},e.prototype._setScale=function(t){for(var e in this.sprites)this.sprites[e].scale=t},e.prototype.reset=function(){this.currentFrame=0},e.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length
},e.prototype.tick=function(){var t=Date.now();t-this._oldTime>this.speed&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._oldTime=t)},e.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},e.prototype.skip=function(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length},e.prototype.draw=function(e,i,n){this.tick(),this._updateValues();var s;this.currentFrame<this.sprites.length&&(s=this.sprites[this.currentFrame],this.flipVertical&&(s.flipVertical=this.flipVertical),this.flipHorizontal&&(s.flipHorizontal=this.flipHorizontal),s.draw(e,i,n)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(s=this.sprites[t.Util.clamp(this.freezeFrame,0,this.sprites.length-1)],s.draw(e,i,n))},e.prototype.play=function(t,e){this.reset(),this._engine.playAnimation(this,t,e)},e}();t.Animation=e})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(e,i){this._log=t.Logger.getInstance(),this.onload=function(){},this.onprogress=function(){},this.onerror=function(){},window.AudioContext?(this._log.debug("Using new Web Audio Api for "+e),this._soundImpl=new o(e,i)):(this._log.debug("Falling back to Audio Element for "+e),this._soundImpl=new n(e,i))}return e.prototype.setVolume=function(t){this._soundImpl.setVolume(t)},e.prototype.setLoop=function(t){this._soundImpl.setLoop(t)},e.prototype.load=function(){this._soundImpl.onload=this.onload,this._soundImpl.onprogress=this.onprogress,this._soundImpl.onerror=this.onerror,this._soundImpl.load()},e.prototype.isPlaying=function(){return this._soundImpl.isPlaying()},e.prototype.play=function(){return this._soundImpl.play()},e.prototype.pause=function(){this._soundImpl.pause()},e.prototype.stop=function(){this._soundImpl.stop()},e}();e.FallbackAudio=i;var n=function(){function e(e,i){var n=this;this.path=e,this._audioElements=Array(5),this._loadedAudio=null,this._isLoaded=!1,this._index=0,this._log=t.Logger.getInstance(),this._isPlaying=!1,this._currentOffset=0,this.onload=function(){},this.onprogress=function(){},this.onerror=function(){};for(var s=0;this._audioElements.length>s;s++)(function(t){n._audioElements[t]=new Audio})(s);i?this.setVolume(t.Util.clamp(i,0,1)):this.setVolume(1)}return e.prototype.isPlaying=function(){return this._isPlaying},e.prototype._audioLoaded=function(){this._isLoaded=!0},e.prototype.setVolume=function(t){var e=0,i=this._audioElements.length;for(e;i>e;e++)this._audioElements[e].volume=t},e.prototype.setLoop=function(t){var e=0,i=this._audioElements.length;for(e;i>e;e++)this._audioElements[e].loop=t},e.prototype.getLoop=function(){this._audioElements.some(function(t){return t.loop})},e.prototype.load=function(){var t=this,e=new XMLHttpRequest;e.open("GET",this.path,!0),e.responseType="blob",e.onprogress=this.onprogress,e.onerror=this.onerror,e.onload=function(i){return 200!==e.status?(t._log.error("Failed to load audio resource ",t.path," server responded with error code",e.status),t.onerror(e.response),t._isLoaded=!1,void 0):(t._loadedAudio=URL.createObjectURL(e.response),t._audioElements.forEach(function(e){e.src=t._loadedAudio}),t.onload(i),void 0)},e.send()},e.prototype.play=function(){var e=this;this._audioElements[this._index].load(),this._audioElements[this._index].play(),this._currentOffset=0;var i=new t.Promise;return this._isPlaying=!0,this.getLoop()||this._audioElements[this._index].addEventListener("ended",function(){e._isPlaying=!1,i.resolve(!0)}),this._index=(this._index+1)%this._audioElements.length,i},e.prototype.pause=function(){this._index=(this._index-1+this._audioElements.length)%this._audioElements.length,this._currentOffset=this._audioElements[this._index].currentTime,this._audioElements.forEach(function(t){t.pause()}),this._isPlaying=!1},e.prototype.stop=function(){this._audioElements.forEach(function(t){t.pause()}),this._isPlaying=!1},e}();if(e.AudioTag=n,window.AudioContext)var s=new window.AudioContext;var o=function(){function e(e,i){this._context=s,this._volume=this._context.createGain(),this._buffer=null,this._sound=null,this._path="",this._isLoaded=!1,this._loop=!1,this._isPlaying=!1,this._isPaused=!1,this._currentOffset=0,this._logger=t.Logger.getInstance(),this.onload=function(){},this.onprogress=function(){},this.onerror=function(){},this._path=e,this._volume.gain.value=i?t.Util.clamp(i,0,1):1}return e.prototype.setVolume=function(t){this._volume.gain.value=t},e.prototype.load=function(){var t=this,e=new XMLHttpRequest;e.open("GET",this._path),e.responseType="arraybuffer",e.onprogress=this.onprogress,e.onerror=this.onerror,e.onload=function(){return 200!==e.status?(t._logger.error("Failed to load audio resource ",t._path," server responded with error code",e.status),t.onerror(e.response),t._isLoaded=!1,void 0):(t._context.decodeAudioData(e.response,function(e){t._buffer=e,t._isLoaded=!0,t.onload(t)},function(){t._logger.error("Unable to decode "+t._path+" this browser may not fully support this format, or the file may be corrupt, "+"if this is an mp3 try removing id3 tags and album art from the file."),t._isLoaded=!1,t.onload(t)}),void 0)};try{e.send()}catch(i){console.error("Error loading sound! If this is a cross origin error, you must host your sound with your html and javascript.")}},e.prototype.setLoop=function(t){this._loop=t},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.play=function(){var e=this;if(this._isLoaded){this._sound=this._context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.loop=this._loop,this._sound.connect(this._volume),this._volume.connect(this._context.destination),this._sound.start(0,this._currentOffset%this._buffer.duration),this._currentOffset=0;var i;return i=this._isPaused&&this._playPromise?this._playPromise:new t.Promise,this._isPaused=!1,this._isPlaying=!0,this._loop||(this._sound.onended=function(){e._isPlaying=!1,e._isPaused||i.resolve(!0)}.bind(this)),this._playPromise=i,i}return t.Promise.wrap(!0)},e.prototype.pause=function(){if(this._isPlaying)try{window.clearTimeout(this._playingTimer),this._sound.stop(0),this._currentOffset=this._context.currentTime,this._isPlaying=!1,this._isPaused=!0}catch(t){this._logger.warn("The sound clip",this._path,"has already been paused!")}},e.prototype.stop=function(){if(this._sound)try{window.clearTimeout(this._playingTimer),this._currentOffset=0,this._sound.stop(0),this._isPlaying=!1,this._isPaused=!1}catch(t){this._logger.warn("The sound clip",this._path,"has already been stopped!")}},e}();e.WebAudio=o})(e=t.Internal||(t.Internal={}))})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected",t[t.Pending=2]="Pending"})(t.PromiseState||(t.PromiseState={})),t.PromiseState;var e=function(){function e(){this._state=2,this._successCallbacks=[],this._rejectCallback=function(){},this._logger=t.Logger.getInstance()}return e.wrap=function(t){var i=(new e).resolve(t);return i},e.join=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];var n=new e;if(!t||!t.length)return n.resolve();var s=t.length,o=0,r=0,h=[];return t.forEach(function(t){t.then(function(){o+=1,o===s?n.resolve():o+r+h.length===s&&n.reject(h)},function(){r+=1,o+r+h.length===s&&n.reject(h)}).error(function(t){h.push(t),h.length+o+r===s&&n.reject(h)})}),n},e.prototype.then=function(t,e){if(t&&(this._successCallbacks.push(t),0===this.state()))try{t.call(this,this._value)}catch(i){this._handleError(i)}if(e&&(this._rejectCallback=e,1===this.state()))try{e.call(this,this._value)}catch(i){this._handleError(i)}return this},e.prototype.error=function(t){return t&&(this._errorCallback=t),this},e.prototype.resolve=function(t){var e=this;if(2!==this._state)throw Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=0,this._successCallbacks.forEach(function(t){t.call(e,e._value)})}catch(i){this._handleError(i)}return this},e.prototype.reject=function(t){if(2!==this._state)throw Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=1,this._rejectCallback.call(this,this._value)}catch(e){this._handleError(e)}return this},e.prototype.state=function(){return this._state},e.prototype._handleError=function(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)},e}();t.Promise=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,n){void 0===n&&(n=!0),this.path=e,this.responseType=i,this.bustCache=n,this.data=null,this.logger=t.Logger.getInstance(),this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){}}return e.prototype.isLoaded=function(){return!!this.data},e.prototype.wireEngine=function(t){this._engine=t},e.prototype._cacheBust=function(t){var e=/\?\w*=\w*/;return t+=e.test(t)?"&__="+Date.now():"?__="+Date.now()},e.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},e.prototype.load=function(){var e=this,i=new t.Promise,n=new XMLHttpRequest;return n.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),n.responseType=this.responseType,n.onloadstart=function(t){e._start(t)},n.onprogress=this.onprogress,n.onerror=this.onerror,n.onload=function(){return 200!==n.status?(e.logger.error("Failed to load resource ",e.path," server responded with error code",n.status),e.onerror(n.response),i.resolve(n.response),void 0):(e.data=e.processDownload(n.response),e.oncomplete(),e.logger.debug("Completed loading resource",e.path),i.resolve(e.data),void 0)},n.send(),i},e.prototype.getData=function(){return this.data},e.prototype.processDownload=function(t){return URL.createObjectURL(t)},e}();t.Resource=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,n){void 0===n&&(n=!0),e.call(this,i,"blob",n),this.path=i,this.bustCache=n,this.loaded=new t.Promise,this._isLoaded=!1,this._sprite=null,this._sprite=new t.Sprite(this,0,0,0,0)}return __extends(i,e),i.prototype.isLoaded=function(){return this._isLoaded},i.prototype.load=function(){var i=this,n=new t.Promise,s=e.prototype.load.call(this);return s.then(function(){i.image=new Image,i.image.addEventListener("load",function(){i._isLoaded=!0,i.width=i._sprite.swidth=i._sprite.width=i.image.naturalWidth,i.height=i._sprite.sheight=i._sprite.height=i.image.naturalHeight,i.loaded.resolve(i.image),n.resolve(i.image)}),i.image.src=e.prototype.getData.call(i)},function(){n.reject("Error loading texture.")}),n},i.prototype.asSprite=function(){return this._sprite},i}(t.Resource);t.Texture=e;var i=function(){function e(){for(var i=[],n=0;arguments.length>n;n++)i[n-0]=arguments[n];this._logger=t.Logger.getInstance(),this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},this.onload=function(){},this._isLoaded=!1,this._selectedFile="",this._wasPlayingOnHidden=!1,this._selectedFile="";for(var s=0;i.length>s;s++)if(e.canPlayFile(i[s])){this._selectedFile=i[s];break}this._selectedFile||(this._logger.warn("This browser does not support any of the files specified"),this._selectedFile=i[0]),this.sound=new t.Internal.FallbackAudio(this._selectedFile,1)}return e.canPlayFile=function(e){try{var i=new Audio,n=/.*\.([A-Za-z0-9]+)$/,s=e.match(n)[1];return i.canPlayType("audio/"+s)?!0:!1}catch(o){return t.Logger.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",o),!1}},e.prototype.wireEngine=function(t){var e=this;t&&(this._engine=t,this._engine.on("hidden",function(){t.pauseAudioWhenHidden&&e.isPlaying()&&(e._wasPlayingOnHidden=!0,e.pause())}),this._engine.on("visible",function(){t.pauseAudioWhenHidden&&e._wasPlayingOnHidden&&(e.play(),e._wasPlayingOnHidden=!1)}))},e.prototype.setVolume=function(t){this.sound&&this.sound.setVolume(t)},e.prototype.setLoop=function(t){this.sound&&this.sound.setLoop(t)},e.prototype.isPlaying=function(){return this.sound?this.sound.isPlaying():void 0},e.prototype.play=function(){return this.sound?this.sound.play():void 0},e.prototype.pause=function(){this.sound&&this.sound.pause()},e.prototype.stop=function(){this.sound&&this.sound.stop()},e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.load=function(){var e=this,i=new t.Promise;return this._logger.debug("Started loading sound",this._selectedFile),this.sound.onprogress=this.onprogress,this.sound.onload=function(){e.oncomplete(),e._isLoaded=!0,e._logger.debug("Completed loading sound",e._selectedFile),i.resolve(e.sound)},this.sound.onerror=function(t){e.onerror(t),i.resolve(t)},this.sound.load(),i},e}();t.Sound=i;var n=function(){function e(t){this._resourceList=[],this._index=0,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},t&&this.addResources(t)}return e.prototype.wireEngine=function(t){this._engine=t},e.prototype.addResource=function(t){var e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++},e.prototype.addResources=function(t){var e=0,i=t.length;for(e;i>e;e++)this.addResource(t[e])},e.prototype._sumCounts=function(t){var e=0;for(var i in t)e+=0|t[i];return e},e.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},e.prototype.load=function(){function e(t,i){t[i]&&t[i].load().then(function(){e(t,i+1)})}var i=this,n=new t.Promise,s=this;if(0===this._resourceList.length)return s.oncomplete.call(s),n;var o=Array(this._resourceList.length),r=this._resourceList.length;return this._resourceList.forEach(function(t,e){i._engine&&t.wireEngine(i._engine),t.onprogress=function(t){var i=t.total,n=t.loaded;o[e]={loaded:n/i*(100/r),total:100};var h=o.reduce(function(t,e){return{loaded:t.loaded+e.loaded,total:100}},{loaded:0,total:100});s.onprogress.call(s,h)},t.oncomplete=t.onerror=function(){s._numLoaded++,s._numLoaded===s._resourceCount&&(s.onprogress.call(s,{loaded:100,total:100}),s.oncomplete.call(s),n.resolve())}}),e(this._resourceList,0),n},e}();t.Loader=n})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.path=e,this._isLoaded=!1,this.logger=t.Logger.getInstance(),this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},this._innerElement=document.createElement("div"),this._innerElement.className="excalibur-template"}return e.prototype.wireEngine=function(t){this._engine=t},e.prototype.getTemplateString=function(){return this._isLoaded?this._htmlString:""},e.prototype._compile=function(){this._innerElement.innerHTML=this._htmlString,this._styleElements=this._innerElement.querySelectorAll("[data-style]"),this._textElements=this._innerElement.querySelectorAll("[data-text]")},e.prototype._evaluateExpresion=function(t,e){var i=Function("return "+t+";"),n=i.call(e);return n},e.prototype.apply=function(t){for(var e=this,i=0;this._styleElements.length>i;i++)(function(){var n={};e._styleElements[i].dataset.style.split(";").forEach(function(t){if(t){var e=t.split(":");n[e[0].trim()]=e[1].trim()}});for(var s in n)(function(){var o=n[s];e._styleElements[i].style[s]=e._evaluateExpresion(o,t)})()})();for(var n=0;this._textElements.length>n;n++)(function(){var i=e._textElements[n].dataset.text;e._textElements[n].innerText=e._evaluateExpresion(i,t)})();return 1===this._innerElement.children.length&&(this._innerElement=this._innerElement.firstChild),this._innerElement},e.prototype.load=function(){var e=this,i=new t.Promise,n=new XMLHttpRequest;return n.open("GET",this.path,!0),n.responseType="text",n.onprogress=this.onprogress,n.onerror=this.onerror,n.onload=function(){return 200!==n.status?(e.logger.error("Failed to load html template resource ",e.path," server responded with error code",n.status),e.onerror(n.response),e._isLoaded=!1,i.resolve("error"),void 0):(e._htmlString=n.response,e.oncomplete(),e.logger.debug("Completed loading template",e.path),e._compile(),e._isLoaded=!0,i.resolve(e._htmlString),void 0)},n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.send(),i},e.prototype.isLoaded=function(){return this._isLoaded},e}();t.Template=e;var i=function(){function t(t,e,i){this.parent=document.getElementById(t),this.template=e,this._ctx=i,this.update()}return t.prototype.listen=function(t,e,i){var n=this;i||(i=function(){n.update()}),t.addEventListener&&e.forEach(function(e){t.addEventListener(e,i)})},t.prototype.update=function(){var t=this._applyTemplate(this.template,this._ctx);t instanceof String&&(this.parent.innerHTML=t),t instanceof Node&&this.parent.lastChild!==t&&this.parent.appendChild(t)},t.prototype._applyTemplate=function(t,e){return t.isLoaded()?t.apply(e):void 0},t}();t.Binding=i})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Start=3]="Start",t[t.End=4]="End"})(t.TextAlign||(t.TextAlign={})),t.TextAlign,function(t){t[t.Top=0]="Top",t[t.Hanging=1]="Hanging",t[t.Middle=2]="Middle",t[t.Alphabetic=3]="Alphabetic",t[t.Ideographic=4]="Ideographic",t[t.Bottom=5]="Bottom"}(t.BaseAlign||(t.BaseAlign={})),t.BaseAlign;var e=function(e){function i(i,n,s,o,r){e.call(this,n,s),this.letterSpacing=0,this.caseInsensitive=!0,this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowColor=t.Color.Black.clone(),this._shadowColorDirty=!1,this._textSprites={},this._shadowSprites={},this._color=t.Color.Black.clone(),this.text=i||"",this.color=t.Color.Black.clone(),this.spriteFont=r,this.collisionType=0,this.font=o||"10px sans-serif",r&&(this._textSprites=r.getTextSprites())}return __extends(i,e),i.prototype.getTextWidth=function(t){var e=t.font;t.font=this.font;var i=t.measureText(this.text).width;return t.font=e,i},i.prototype._lookupTextAlign=function(t){switch(t){case 0:return"left";case 1:return"right";case 2:return"center";case 4:return"end";case 3:return"start";default:return"start"}},i.prototype._lookupBaseAlign=function(t){switch(t){case 3:return"alphabetic";case 5:return"bottom";case 1:return"hangin";case 4:return"ideographic";case 2:return"middle";case 0:return"top";default:return"alphabetic"}},i.prototype.setTextShadow=function(t,e,i){this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._shadowColor=i.clone(),this._shadowColorDirty=!0;for(var n in this._textSprites)this._shadowSprites[n]=this._textSprites[n].clone()},i.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowColor=t.Color.Black.clone()},i.prototype.update=function(i,n){if(e.prototype.update.call(this,i,n),this.spriteFont&&this._color!==this.color)for(var s in this._textSprites)this._textSprites[s].clearEffects(),this._textSprites[s].addEffect(new t.Effects.Fill(this.color.clone())),this._color=this.color;if(this.spriteFont&&this._textShadowOn&&this._shadowColorDirty&&this._shadowColor){for(var o in this._shadowSprites)this._shadowSprites[o].clearEffects(),this._shadowSprites[o].addEffect(new t.Effects.Fill(this._shadowColor.clone()));this._shadowColorDirty=!1}},i.prototype.draw=function(t,i){t.save(),t.translate(this.x,this.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.rotation),this._textShadowOn&&(t.save(),t.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(t,i,this._shadowSprites),t.restore()),this._fontDraw(t,i,this._textSprites),e.prototype.draw.call(this,t,i),t.restore()},i.prototype._fontDraw=function(e,i,n){if(this.spriteFont){for(var s=0,o=0;this.text.length>o;o++){var r=this.text[o];this.caseInsensitive&&(r=r.toLowerCase());try{var h=n[r];this.previousOpacity!==this.opacity&&(h.clearEffects(),h.addEffect(new t.Effects.Opacity(this.opacity))),h.draw(e,s,0),s+=h.swidth+this.letterSpacing}catch(a){t.Logger.getInstance().error("SpriteFont Error drawing char "+r)}}this.previousOpacity!==this.opacity&&(this.previousOpacity=this.opacity)}else{var c=e.textAlign,u=e.textBaseline;e.textAlign=this._lookupTextAlign(this.textAlign),e.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),e.fillStyle=""+this.color,e.font=this.font,this.maxWidth?e.fillText(this.text,0,0,this.maxWidth):e.fillText(this.text,0,0),e.textAlign=c,e.textBaseline=u}},i.prototype.debugDraw=function(t){e.prototype.debugDraw.call(this,t)},i}(t.Actor);t.Label=e})(ex||(ex={}));var ex;(function(t){var e;(function(e){(function(t){t[t.Touch=0]="Touch",t[t.Mouse=1]="Mouse",t[t.Pen=2]="Pen",t[t.Unknown=3]="Unknown"})(e.PointerType||(e.PointerType={})),e.PointerType,function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Unknown=3]="Unknown"}(e.PointerButton||(e.PointerButton={})),e.PointerButton,function(t){t[t.Canvas=0]="Canvas",t[t.Document=1]="Document"}(e.PointerScope||(e.PointerScope={})),e.PointerScope;var i=function(t){function e(e,i,n,s,o,r){t.call(this),this.x=e,this.y=i,this.index=n,this.pointerType=s,this.button=o,this.ev=r}return __extends(e,t),e}(t.GameEvent);e.PointerEvent=i;var n=function(e){function n(t){e.call(this),this._pointerDown=[],this._pointerUp=[],this._pointerMove=[],this._pointerCancel=[],this._pointers=[],this._activePointers=[],this._engine=t,this._pointers.push(new s),this._activePointers=[-1],this.primary=this._pointers[0]}return __extends(n,e),n.prototype.init=function(t){void 0===t&&(t=1);var e=document;e=1===t?document:this._engine.canvas,e.addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),e.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),e.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),e.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",e.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),e.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),e.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),e.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerMove))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",e.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),e.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),e.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),e.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerMove))):(e.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),e.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),e.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove)))},n.prototype.update=function(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0},n.prototype.at=function(t){if(t>=this._pointers.length)for(var e=this._pointers.length-1,i=t;i>e;e++)this._pointers.push(new s),this._activePointers.push(-1);return this._pointers[t]},n.prototype.count=function(){return this._pointers.length},n.prototype.propogate=function(e){var i=e instanceof t.UIActor,n=0,s=this._pointerUp.length;for(n;s>n;n++)e.contains(this._pointerUp[n].x,this._pointerUp[n].y,!i)&&e.eventDispatcher.publish("pointerup",this._pointerUp[n]);for(n=0,s=this._pointerDown.length,n;s>n;n++)e.contains(this._pointerDown[n].x,this._pointerDown[n].y,!i)&&e.eventDispatcher.publish("pointerdown",this._pointerDown[n]);if(e.capturePointer.captureMoveEvents)for(n=0,s=this._pointerMove.length,n;s>n;n++)e.contains(this._pointerMove[n].x,this._pointerMove[n].y,!i)&&e.eventDispatcher.publish("pointermove",this._pointerMove[n]);for(n=0,s=this._pointerCancel.length,n;s>n;n++)e.contains(this._pointerCancel[n].x,this._pointerCancel[n].y,!i)&&e.eventDispatcher.publish("pointercancel",this._pointerCancel[n])},n.prototype._handleMouseEvent=function(e,n){var s=this;return function(o){o.preventDefault();var r=o.pageX-t.Util.getPosition(s._engine.canvas).x,h=o.pageY-t.Util.getPosition(s._engine.canvas).y,a=s._engine.screenToWorldCoordinates(new t.Point(r,h)),c=new i(a.x,a.y,0,1,o.button,o);n.push(c),s.at(0).eventDispatcher.publish(e,c)}},n.prototype._handleTouchEvent=function(e,n){var s=this;return function(o){o.preventDefault();for(var r=0,h=o.changedTouches.length;h>r;r++){var a=s._pointers.length>1?s._getPointerIndex(o.changedTouches[r].identifier):0;if(-1!==a){var c=o.changedTouches[r].pageX-t.Util.getPosition(s._engine.canvas).x,u=o.changedTouches[r].pageY-t.Util.getPosition(s._engine.canvas).y,l=s._engine.screenToWorldCoordinates(new t.Point(c,u)),p=new i(l.x,l.y,a,0,3,o);n.push(p),s.at(a).eventDispatcher.publish(e,p),s._pointers.length>1&&("up"===e?s._activePointers[a]=-1:"down"===e&&(s._activePointers[a]=o.changedTouches[r].identifier))}}}},n.prototype._handlePointerEvent=function(e,n){var s=this;return function(o){o.preventDefault();var r=s._pointers.length>1?s._getPointerIndex(o.pointerId):0;if(-1!==r){var h=o.pageX-t.Util.getPosition(s._engine.canvas).x,a=o.pageY-t.Util.getPosition(s._engine.canvas).y,c=s._engine.screenToWorldCoordinates(new t.Point(h,a)),u=new i(c.x,c.y,r,s._stringToPointerType(o.pointerType),o.button,o);n.push(u),s.at(r).eventDispatcher.publish(e,u),s._pointers.length>1&&("up"===e?s._activePointers[r]=-1:"down"===e&&(s._activePointers[r]=o.pointerId))}}},n.prototype._getPointerIndex=function(t){var e;if((e=this._activePointers.indexOf(t))>-1)return e;for(var i=0;this._activePointers.length>i;i++)if(-1===this._activePointers[i])return i;return-1},n.prototype._stringToPointerType=function(t){switch(t){case"touch":return 0;case"mouse":return 1;case"pen":return 2;default:return 3}},n}(t.Class);e.Pointers=n;var s=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.Class);e.Pointer=s})(e=t.Input||(t.Input={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){(function(t){t[t.Num1=97]="Num1",t[t.Num2=98]="Num2",t[t.Num3=99]="Num3",t[t.Num4=100]="Num4",t[t.Num5=101]="Num5",t[t.Num6=102]="Num6",t[t.Num7=103]="Num7",t[t.Num8=104]="Num8",t[t.Num9=105]="Num9",t[t.Num0=96]="Num0",t[t.Numlock=144]="Numlock",t[t.Semicolon=186]="Semicolon",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Shift=16]="Shift",t[t.Alt=18]="Alt",t[t.Up=38]="Up",t[t.Down=40]="Down",t[t.Left=37]="Left",t[t.Right=39]="Right",t[t.Space=32]="Space",t[t.Esc=27]="Esc"})(e.Keys||(e.Keys={})),e.Keys;var i=function(t){function e(e){t.call(this),this.key=e}return __extends(e,t),e}(t.GameEvent);e.KeyEvent=i;var n=function(t){function e(e){t.call(this),this._keys=[],this._keysUp=[],this._keysDown=[],this._engine=e}return __extends(e,t),e.prototype.init=function(){var t=this;window.addEventListener("blur",function(){t._keys.length=0}),window.addEventListener("keyup",function(e){var n=t._keys.indexOf(e.keyCode);t._keys.splice(n,1),t._keysUp.push(e.keyCode);var s=new i(e.keyCode);t.eventDispatcher.publish("up",s)}),window.addEventListener("keydown",function(e){if(-1===t._keys.indexOf(e.keyCode)){t._keys.push(e.keyCode),t._keysDown.push(e.keyCode);var n=new i(e.keyCode);t.eventDispatcher.publish("down",n)}})},e.prototype.update=function(){this._keysDown.length=0,this._keysUp.length=0},e.prototype.getKeys=function(){return this._keys},e.prototype.isKeyDown=function(t){return this._keysDown.indexOf(t)>-1},e.prototype.isKeyPressed=function(t){return this._keys.indexOf(t)>-1},e.prototype.isKeyUp=function(t){return this._keysUp.indexOf(t)>-1},e}(t.Class);e.Keyboard=n})(e=t.Input||(t.Input={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(t){function e(e){t.call(this),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._engine=e}return __extends(e,t),e.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},e.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var t=this._navigator.getGamepads(),e=0;t.length>e;e++)if(t[e]){if(this.at(e).connected=!0,!t[e].timestamp||t[e].timestamp!==this._gamePadTimeStamps[e]){this._gamePadTimeStamps[e]=t[e].timestamp;var i,n,a,c,u;for(i in s)"number"==typeof s[i]&&(c=s[i],a=t[e].buttons[c].value,a!==this._oldPads[e].getButton(c)&&(t[e].buttons[c].pressed?(this.at(e).updateButton(c,a),this.at(e).eventDispatcher.publish("button",new r(c,a))):this.at(e).updateButton(c,0)));for(n in o)"number"==typeof o[n]&&(u=o[n],a=t[e].axes[u],a!==this._oldPads[e].getAxes(u)&&(this.at(e).updateAxes(u,a),this.at(e).eventDispatcher.publish("axis",new h(u,a))));this._oldPads[e]=this._clonePad(t[e])}}else this.at(e).connected=!1}},e.prototype.at=function(t){if(t>=this._pads.length)for(var e=this._pads.length-1,i=t;i>e;e++)this._pads.push(new n),this._oldPads.push(new n);return this._pads[t]},e.prototype.count=function(){return this._pads.filter(function(t){return t.connected}).length},e.prototype._clonePads=function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(this._clonePad(t[i]));return e},e.prototype._clonePad=function(t){var e,i,s=new n;if(!t)return s;for(e=0,i=t.buttons.length;i>e;e++)s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;i>e;e++)s.updateAxes(e,t.axes[e]);return s},e.MinAxisMoveThreshold=.05,e}(t.Class);e.Gamepads=i;var n=function(t){function e(){t.call(this),this.connected=!1,this._buttons=Array(16),this._axes=Array(4);var e;for(e=0;this._buttons.length>e;e++)this._buttons[e]=0;for(e=0;this._axes.length>e;e++)this._axes[e]=0}return __extends(e,t),e.prototype.isButtonPressed=function(t,e){return void 0===e&&(e=1),this._buttons[t]>=e},e.prototype.getButton=function(t){return this._buttons[t]},e.prototype.getAxes=function(t){var e=this._axes[t];return Math.abs(e)<i.MinAxisMoveThreshold?0:e},e.prototype.updateButton=function(t,e){this._buttons[t]=e},e.prototype.updateAxes=function(t,e){this._axes[t]=e},e}(t.Class);e.Gamepad=n,function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(e.Buttons||(e.Buttons={}));var s=e.Buttons;(function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"})(e.Axes||(e.Axes={}));var o=e.Axes,r=function(t){function e(e,i){t.call(this),this.button=e,this.value=i}return __extends(e,t),e}(t.GameEvent);e.GamepadButtonEvent=r;var h=function(t){function e(e,i){t.call(this),this.axis=e,this.value=i}return __extends(e,t),e}(t.GameEvent);e.GamepadAxisEvent=h})(e=t.Input||(t.Input={}))})(ex||(ex={}));var ex;(function(t){var e=function(e){function n(){e.call(this),this.collisionStrategy=1,this._hasStarted=!1,this.fps=0,this.postProcessors=[],this.scenes={},this._animations=[],this.isFullscreen=!1,this.displayMode=0,this.pauseAudioWhenHidden=!0,this.isDebug=!1,this.debugColor=new t.Color(255,255,255),this.backgroundColor=new t.Color(0,0,100),this._isSmoothingEnabled=!0,this._isLoading=!1,this._progress=0,this._total=1;var i,n,s,o,r=null;"number"==typeof arguments[0]?(i=arguments[0],n=arguments[1],s=arguments[2],o=arguments[3]):(r=arguments[0]||{width:0,height:0,canvasElementId:"",displayMode:0},i=r.width,n=r.height,s=r.canvasElementId,o=r.displayMode),this._logger=t.Logger.getInstance(),this._logger.info('Powered by Excalibur.js visit", "http://excaliburjs.com", "for more information.'),this._logger.debug("Building engine..."),this.canvasElementId=s,s?(this._logger.debug("Using Canvas element specified: "+s),this.canvas=document.getElementById(s)):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas")),i&&n?(void 0===o&&(this.displayMode=2),this._logger.debug("Engine viewport is size "+i+" x "+n),this.width=i,this.canvas.width=i,this.height=n,this.canvas.height=n):o||(this._logger.debug("Engine viewport is fullscreen"),this.displayMode=0),this._loader=new t.Loader,this._initialize(r),this.rootScene=this.currentScene=new t.Scene(this),this.addScene("root",this.rootScene),this.goToScene("root")
}return __extends(n,e),n.prototype.playAnimation=function(t,e,n){this._animations.push(new i(t,e,n))},n.prototype.addChild=function(t){this.currentScene.addChild(t)},n.prototype.removeChild=function(t){this.currentScene.removeChild(t)},n.prototype.addTileMap=function(t){this.currentScene.addTileMap(t)},n.prototype.removeTileMap=function(t){this.currentScene.removeTileMap(t)},n.prototype.addTimer=function(t){return this.currentScene.addTimer(t)},n.prototype.removeTimer=function(t){return this.currentScene.removeTimer(t)},n.prototype.addScene=function(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,e.engine=this},n.prototype.removeScene=function(e){if(e instanceof t.Scene)for(var i in this.scenes)this.scenes.hasOwnProperty(i)&&this.scenes[i]===e&&delete this.scenes[i];"string"==typeof e&&delete this.scenes[e]},n.prototype.add=function(e){return e instanceof t.UIActor?(this.currentScene.addUIActor(e),void 0):(e instanceof t.Actor&&this.addChild(e),e instanceof t.Timer&&this.addTimer(e),e instanceof t.TileMap&&this.addTileMap(e),2===arguments.length&&this.addScene(arguments[0],arguments[1]),void 0)},n.prototype.remove=function(e){return e instanceof t.UIActor?(this.currentScene.removeUIActor(e),void 0):(e instanceof t.Actor&&this.removeChild(e),e instanceof t.Timer&&this.removeTimer(e),e instanceof t.TileMap&&this.removeTileMap(e),e instanceof t.Scene&&this.removeScene(e),"string"==typeof e&&this.removeScene(e),void 0)},n.prototype.goToScene=function(e){if(this.scenes[e]){var i=this.currentScene,n=this.scenes[e];this._logger.debug("Going to scene:",e),this.currentScene.isInitialized&&(this.currentScene.onDeactivate.call(this.currentScene),this.currentScene.eventDispatcher.publish("deactivate",new t.DeactivateEvent(n))),this.currentScene=n,this.currentScene.isInitialized||(this.currentScene.onInitialize.call(this.currentScene,this),this.currentScene.eventDispatcher.publish("initialize",new t.InitializeEvent(this)),this.currentScene.isInitialized=!0),this.currentScene.onActivate.call(this.currentScene),this.currentScene.eventDispatcher.publish("activate",new t.ActivateEvent(i))}else this._logger.error("Scene",e,"does not exist!")},n.prototype.getWidth=function(){return this.currentScene&&this.currentScene.camera?this.width/this.currentScene.camera.getZoom():this.width},n.prototype.getHeight=function(){return this.currentScene&&this.currentScene.camera?this.height/this.currentScene.camera.getZoom():this.height},n.prototype.screenToWorldCoordinates=function(e){var i=e.x,n=e.y;if(this.currentScene&&this.currentScene.camera){var s=this.currentScene.camera.getFocus();i=s.x+(e.x-this.getWidth()/2),n=s.y+(e.y-this.getHeight()/2)}return i=Math.floor(i/this.canvas.clientWidth*this.getWidth()),n=Math.floor(n/this.canvas.clientHeight*this.getHeight()),new t.Point(i,n)},n.prototype.worldToScreenCoordinates=function(e){var i=e.x,n=e.y;if(this.currentScene&&this.currentScene.camera){var s=this.currentScene.camera.getFocus();i=e.x-s.x+this.getWidth()/2,n=e.y-s.y+this.getHeight()/2}return i=Math.floor(i/this.getWidth()*this.canvas.clientWidth),n=Math.floor(n/this.getHeight()*this.canvas.clientHeight),new t.Point(i,n)},n.prototype._setHeightByDisplayMode=function(t){1===this.displayMode&&(this.width=this.canvas.width=t.clientWidth,this.height=this.canvas.height=t.clientHeight),0===this.displayMode&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.width=this.canvas.width=t.innerWidth,this.height=this.canvas.height=t.innerHeight)},n.prototype._initialize=function(e){var i=this;if(0===this.displayMode||1===this.displayMode){var n=1===this.displayMode?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(n),window.addEventListener("resize",function(){i._logger.debug("View port resized"),i._setHeightByDisplayMode(n),i._logger.info("parent.clientHeight "+n.clientHeight),i.setAntialiasing(i._isSmoothingEnabled)})}this.input={keyboard:new t.Input.Keyboard(this),pointers:new t.Input.Pointers(this),gamepads:new t.Input.Gamepads(this)},this.input.keyboard.init(),this.input.pointers.init(e?e.pointerScope:1),this.input.gamepads.init(),document.addEventListener("visibilitychange",function(){document.hidden||document.msHidden?(i.eventDispatcher.publish("hidden",new t.HiddenEvent),i._logger.debug("Window hidden")):(i.eventDispatcher.publish("visible",new t.VisibleEvent),i._logger.debug("Window visible"))}),this.ctx=this.canvas.getContext("2d"),this.canvasElementId||document.body.appendChild(this.canvas)},n.prototype.setAntialiasing=function(t){this._isSmoothingEnabled=t,this.ctx.imageSmoothingEnabled=t,this.ctx.webkitImageSmoothingEnabled=t,this.ctx.mozImageSmoothingEnabled=t,this.ctx.msImageSmoothingEnabled=t},n.prototype.getAntialiasing=function(){return this.ctx.imageSmoothingEnabled||this.ctx.webkitImageSmoothingEnabled||this.ctx.mozImageSmoothingEnabled||this.ctx.msImageSmoothingEnabled},n.prototype._update=function(e){this._isLoading||(this.currentScene.update(this,e),this._animations=this._animations.filter(function(t){return!t.animation.isDone()}),this.input.keyboard.update(e),this.input.pointers.update(e),this.input.gamepads.update(e),this.eventDispatcher.publish(t.EventType[5],new t.UpdateEvent(e)))},n.prototype._draw=function(e){var i=this.ctx;if(this._isLoading)return i.fillStyle="black",i.fillRect(0,0,this.width,this.height),this._drawLoadingBar(i,this._progress,this._total),void 0;i.clearRect(0,0,this.width,this.height),i.fillStyle=""+this.backgroundColor,i.fillRect(0,0,this.width,this.height),this.currentScene.draw(this.ctx,e);var n=0,s=this._animations.length;for(n;s>n;n++)this._animations[n].animation.draw(i,this._animations[n].x,this._animations[n].y);if(this.fps=1/(e/1e3),this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=""+this.debugColor;for(var o=this.input.keyboard.getKeys(),r=0;o.length>r;r++)this.ctx.fillText(""+o[r]+" : "+(t.Input.Keys[o[r]]?t.Input.Keys[o[r]]:"Not Mapped"),100,10*r+10);this.ctx.fillText("FPS:"+(""+this.fps.toFixed(2)),10,10)}for(var h=0;this.postProcessors.length>h;h++)this.postProcessors[h].process(this.ctx.getImageData(0,0,this.width,this.height),this.ctx)},n.prototype.start=function(e){var i;if(e?(e.wireEngine(this),i=this.load(e)):i=t.Promise.wrap(),!this._hasStarted){this._hasStarted=!0,this._logger.debug("Starting game...");var n=Date.now(),s=this;(function o(){if(s._hasStarted){window.requestAnimationFrame(o);var t=Date.now(),e=Math.floor(t-n)||1;e>200&&(e=1),s._update(e),s._draw(e),n=t}})(),this._logger.debug("Game started")}return i},n.prototype.stop=function(){this._hasStarted&&(this._hasStarted=!1,this._logger.debug("Game stopped"))},n.prototype.screenshot=function(){var t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t},n.prototype._drawLoadingBar=function(t,e,i){if(this._loadingDraw)return this._loadingDraw(t,e,i),void 0;var n=this.canvas.height/2,s=this.canvas.width/3,o=s,r=new Image;r.src="data:image/png;base64,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";var h=3*s/8,a=this.getAntialiasing();this.setAntialiasing(!0),t.drawImage(r,0,0,800,300,o,n-h-20,s,h),t.strokeStyle="white",t.lineWidth=2,t.strokeRect(o,n,s,20);var c=s*(e/i);t.fillStyle="white";var u=5,l=c-2*u,p=20-2*u;t.fillRect(o+u,n+u,l>0?l:0,p),this.setAntialiasing(a)},n.prototype.setLoadingDrawFunction=function(t){this._loadingDraw=t},n.prototype.load=function(e){var i=this,n=new t.Promise;return this._isLoading=!0,e.onprogress=function(t){i._progress=t.loaded,i._total=t.total,i._logger.debug("Loading "+(100*i._progress/i._total).toFixed(0))},e.oncomplete=function(){setTimeout(function(){i._isLoading=!1,n.resolve()},500)},e.load(),n},n}(t.Class);t.Engine=e,function(t){t[t.FullScreen=0]="FullScreen",t[t.Container=1]="Container",t[t.Fixed=2]="Fixed"}(t.DisplayMode||(t.DisplayMode={})),t.DisplayMode;var i=function(){function t(t,e,i){this.animation=t,this.x=e,this.y=i}return t}()})(ex||(ex={}));
;
// Concatenated onto excalibur after build
// Exports the excalibur module so it can be used with browserify
// https://github.com/excaliburjs/Excalibur/issues/312
if (typeof module !== 'undefined') {module.exports = ex;}